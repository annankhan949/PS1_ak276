<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.33">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="ak276">
<meta name="dcterms.date" content="2025-09-27">

<title>CEVE 543 Fall 2025 Problem Set 1</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="index_files/libs/clipboard/clipboard.min.js"></script>
<script src="index_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="index_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="index_files/libs/quarto-html/popper.min.js"></script>
<script src="index_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="index_files/libs/quarto-html/anchor.min.js"></script>
<link href="index_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="index_files/libs/quarto-html/quarto-syntax-highlighting-ea385d0e468b0dd5ea5bf0780b1290d9.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="index_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="index_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="index_files/libs/bootstrap/bootstrap-1535ef6d33ce075279ea64f7edb8585b.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul class="collapse">
  <li><a href="#task-1" id="toc-task-1" class="nav-link active" data-scroll-target="#task-1">Task 1</a></li>
  <li><a href="#task-2" id="toc-task-2" class="nav-link" data-scroll-target="#task-2">Task 2</a></li>
  <li><a href="#task-3" id="toc-task-3" class="nav-link" data-scroll-target="#task-3">Task 3</a></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="index.pdf"><i class="bi bi-file-pdf"></i>Typst</a></li></ul></div></nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">CEVE 543 Fall 2025 Problem Set 1</h1>
<p class="subtitle lead">Estimating GEV parameters and characterizing uncertainty</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>ak276 </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">September 27, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<div id="f4f0ca06" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Pkg</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="bu">Pkg</span>.<span class="fu">activate</span>(<span class="st">"."</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="bu">Pkg</span>.<span class="fu">instantiate</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<div class="ansi-escaped-output">
<pre><span class="ansi-green-fg ansi-bold">  Activating</span> 
project at `~/Desktop/CEVE 543 Problem Sets/PS1_ak276`
</pre>
</div>
</div>
</div>
<div id="219d3a87" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">IJulia</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Turing</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ArviZ</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">NCDatasets</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Optim</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Unitful</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Downloads</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Extremes</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Statistics</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ColorSchemes</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">GeoMakie</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Makie.Unitful</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Makie.Dates</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="a6fc76e0" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">CairoMakie</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>CairoMakie.<span class="fu">activate!</span>(<span class="kw">type</span><span class="op">=</span><span class="st">"svg"</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Downloads</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">DataFrames</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="cn">ENV</span>[<span class="st">"DATAFRAMES_ROWS"</span>] <span class="op">=</span> <span class="fl">5</span> </span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">TidierData</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>lab_dir <span class="op">=</span> <span class="fu">dirname</span>(<span class="pp">@__FILE__</span>)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="fu">include</span>(<span class="st">"util.jl"</span>)</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> <span class="fu">MersenneTwister</span>(<span class="fl">345</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<pre><code>MersenneTwister(345)</code></pre>
</div>
</div>
<section id="task-1" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="task-1">Task 1</h2>
<section id="data-extraction-and-visualization" class="level3" data-number="0.1">
<h3 data-number="0.1" class="anchored" data-anchor-id="data-extraction-and-visualization"><span class="header-section-number">0.1</span> Data Extraction and Visualization</h3>
<div id="dcf92377" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>stations, rainfall_data <span class="op">=</span> <span class="kw">let</span> </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    precip_fname <span class="op">=</span> <span class="fu">joinpath</span>(lab_dir, </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"dur01d_ams_na14v11.txt"</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    url <span class="op">=</span> <span class="st">"https://hdsc.nws.noaa.gov/pub/hdsc/data/tx/dur01d_ams_na14v11.txt"</span> </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> !<span class="fu">isfile</span>(precip_fname)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>        <span class="bu">Downloads</span>.<span class="fu">download</span>(url, precip_fname)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">read_noaa_data</span>(precip_fname)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<div class="ansi-escaped-output">
<pre>(<span class="ansi-bold">816×7 DataFrame</span>
<span class="ansi-bold"> Row </span>│<span class="ansi-bold"> stnid </span><span class="ansi-bold"> noaa_id </span><span class="ansi-bold"> name                           </span><span class="ansi-bold"> state  </span><span class="ansi-bold"> latitude </span><span class="ansi-bold"> longi</span> ⋯
     │<span class="ansi-bright-black-fg"> Int64 </span><span class="ansi-bright-black-fg"> String  </span><span class="ansi-bright-black-fg"> String                         </span><span class="ansi-bright-black-fg"> String </span><span class="ansi-bright-black-fg"> Float64  </span><span class="ansi-bright-black-fg"> Float</span> ⋯
─────┼──────────────────────────────────────────────────────────────────────────
   1 │     1  60-0011  CLEAR CK AT BAY AREA BLVD       TX       29.4977   -95. ⋯
   2 │     2  60-0019  TURKEY CK AT FM 1959            TX       29.5845   -95.
   3 │     3  60-0022  ARMAND BYU AT GENOARED BLF RD   TX       29.6345   -95.
   4 │     4  60-0068  E FORK SAN JACINTO AT FM 1485   TX       30.1453   -95.
   5 │     5  60-0082  CYPRESS CK AT KUYKENDAHL RD     TX       30.0244   -95. ⋯
   6 │     6  60-0104  GREENS BYU AT MT HOUSTON PKWY   TX       29.892    -95.
   7 │     7  60-0121  CEDAR BYU AT US 90              TX       29.9729   -94.
   8 │     8  63-0187  JOLLYVILLE 2 SW                 TX       30.4208   -97.
   9 │     9  63-0191  BARTON CRK AT SH 71 N OAK HILL  TX       30.2963   -97. ⋯
  10 │    10  63-0192  BARTON CRK AT LOOP 360, AUSTIN  TX       30.2442   -97.
  11 │    11  81-0004  MCCREE BRANCH @ WHITE ROCK TRA  TX       32.8717   -96.
  ⋮  │   ⋮       ⋮                   ⋮                   ⋮        ⋮          ⋮ ⋱
 807 │   807  79-0125  EL PASO                         TX       31.7587  -106.
 808 │   808  79-0126  FT STOCKTON PECOS AP            TX       30.9119  -102. ⋯
 809 │   809  79-0142  CORSICANA CAMPBELL FLD          TX       32.0311   -96.
 810 │   810  79-0149  DALHART MUNI AP                 TX       36.0167  -102.
 811 │   811  79-0150  DALLAS HENSLEY FLD NAS          TX       32.7333   -96.
 812 │   812  79-0153  PALESTINE 2 NE                  TX       31.7831   -95. ⋯
 813 │   813  79-0157  MINERAL WELLS AP                TX       32.7817   -98.
 814 │   814  79-0159  LUFKIN ANGELINA CO AP           TX       31.2361   -94.
 815 │   815  87-0031  SECO CREEK AT MILLER RANCH      TX       29.5731   -99.
 816 │   816  99-2048  COTULLA                         TX       28.4567   -99. ⋯
<span class="ansi-cyan-fg">                                                  2 columns and 795 rows omitted</span>, <span class="ansi-bold">61925×4 DataFrame</span>
<span class="ansi-bold">   Row </span>│<span class="ansi-bold"> stnid </span><span class="ansi-bold"> date       </span><span class="ansi-bold"> year  </span><span class="ansi-bold"> rainfall   </span>
       │<span class="ansi-bright-black-fg"> Int64 </span><span class="ansi-bright-black-fg"> Date       </span><span class="ansi-bright-black-fg"> Int64 </span><span class="ansi-bright-black-fg"> Quantity…? </span>
───────┼──────────────────────────────────────
     1 │     1  1987-06-11   1987   6.31 inch
     2 │     1  1988-09-02   1988   5.46 inch
     3 │     1  1989-08-01   1989  11.39 inch
     4 │     1  1990-05-03   1990   3.32 inch
     5 │     1  1991-04-04   1991   5.73 inch
     6 │     1  1992-06-01   1992   4.61 inch
     7 │     1  1993-04-03   1993   4.71 inch
     8 │     1  1994-01-01   1994 <span class="ansi-bright-black-fg">    missing </span>
     9 │     1  1995-05-30   1995   5.63 inch
    10 │     1  1996-06-24   1996   3.39 inch
    11 │     1  1997-09-22   1997   8.88 inch
   ⋮   │   ⋮        ⋮         ⋮        ⋮
 61916 │   816  2008-10-15   2008   1.19 inch
 61917 │   816  2009-04-17   2009    3.5 inch
 61918 │   816  2010-05-25   2010   2.56 inch
 61919 │   816  2011-10-09   2011   1.64 inch
 61920 │   816  2012-02-04   2012   1.67 inch
 61921 │   816  2013-10-13   2013   6.65 inch
 61922 │   816  2014-07-17   2014   1.91 inch
 61923 │   816  2015-05-15   2015   2.07 inch
 61924 │   816  2016-08-20   2016   3.44 inch
 61925 │   816  2017-09-25   2017   2.72 inch
<span class="ansi-cyan-fg">                            61904 rows omitted</span>)</pre>
</div>
</div>
</div>
<div id="68f35e37" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@chain</span> stations <span class="cf">begin</span>  </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@select</span>(stnid, noaa_id, name, state, latitude, longitude, years_of_data)  </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<div><div style="float: left;"><span>816×7 DataFrame</span></div><div style="float: right;"><span style="font-style: italic;">811 rows omitted</span></div><div style="clear: both;"></div></div><div class="data-frame" style="overflow-x: scroll;">
<table class="data-frame caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th class="rowNumber" data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;">Row</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">stnid</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">noaa_id</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">name</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">state</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">latitude</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">longitude</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">years_of_data</th>
</tr>
<tr class="subheader headerLastRow even">
<th class="rowNumber" data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Int64">Int64</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="String">String</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="String">String</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="String">String</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Float64">Float64</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Float64">Float64</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Int64">Int64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">60-0011</td>
<td style="text-align: left;">CLEAR CK AT BAY AREA BLVD</td>
<td style="text-align: left;">TX</td>
<td style="text-align: right;">29.4977</td>
<td style="text-align: right;">-95.1599</td>
<td style="text-align: right;">31</td>
</tr>
<tr class="even">
<td class="rowNumber" style="text-align: right; font-weight: bold;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">60-0019</td>
<td style="text-align: left;">TURKEY CK AT FM 1959</td>
<td style="text-align: left;">TX</td>
<td style="text-align: right;">29.5845</td>
<td style="text-align: right;">-95.1869</td>
<td style="text-align: right;">31</td>
</tr>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">60-0022</td>
<td style="text-align: left;">ARMAND BYU AT GENOARED BLF RD</td>
<td style="text-align: left;">TX</td>
<td style="text-align: right;">29.6345</td>
<td style="text-align: right;">-95.1123</td>
<td style="text-align: right;">31</td>
</tr>
<tr class="even">
<td style="text-align: right;">⋮</td>
<td style="text-align: right;">⋮</td>
<td style="text-align: right;">⋮</td>
<td style="text-align: right;">⋮</td>
<td style="text-align: right;">⋮</td>
<td style="text-align: right;">⋮</td>
<td style="text-align: right;">⋮</td>
<td style="text-align: right;">⋮</td>
</tr>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">815</td>
<td style="text-align: right;">815</td>
<td style="text-align: left;">87-0031</td>
<td style="text-align: left;">SECO CREEK AT MILLER RANCH</td>
<td style="text-align: left;">TX</td>
<td style="text-align: right;">29.5731</td>
<td style="text-align: right;">-99.4028</td>
<td style="text-align: right;">20</td>
</tr>
<tr class="even">
<td class="rowNumber" style="text-align: right; font-weight: bold;">816</td>
<td style="text-align: right;">816</td>
<td style="text-align: left;">99-2048</td>
<td style="text-align: left;">COTULLA</td>
<td style="text-align: left;">TX</td>
<td style="text-align: right;">28.4567</td>
<td style="text-align: right;">-99.2183</td>
<td style="text-align: right;">116</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="ebf75ec9" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>stations_most <span class="op">=</span> <span class="pp">@chain</span> stations <span class="cf">begin</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>     <span class="pp">@filter</span>(years_of_data <span class="op">&gt;</span> <span class="fl">50</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>     <span class="pp">@arrange</span>(<span class="fu">desc</span>(years_of_data))</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>     <span class="pp">@slice_head</span>(n<span class="op">=</span><span class="fl">15</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="fu">show</span>(stations_most[<span class="fl">1</span><span class="op">:</span><span class="fl">15</span>, <span class="op">:</span>], allrows <span class="op">=</span> <span class="cn">true</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<div class="ansi-escaped-output">
<pre><span class="ansi-bold">15×7 DataFrame</span>

<span class="ansi-bold"> Row </span>│<span class="ansi-bold"> stnid </span><span class="ansi-bold"> noaa_id </span><span class="ansi-bold"> name                 </span><span class="ansi-bold"> state  </span><span class="ansi-bold"> latitude </span><span class="ansi-bold"> longitude </span><span class="ansi-bold"> year</span> ⋯

     │<span class="ansi-bright-black-fg"> Int64 </span><span class="ansi-bright-black-fg"> String  </span><span class="ansi-bright-black-fg"> String               </span><span class="ansi-bright-black-fg"> String </span><span class="ansi-bright-black-fg"> Float64  </span><span class="ansi-bright-black-fg"> Float64   </span><span class="ansi-bright-black-fg"> Int6</span> ⋯

─────┼──────────────────────────────────────────────────────────────────────────

   1 │   112  41-0420  AUSTIN                TX       30.2682   -97.7426       ⋯

   2 │   600  41-7622  RIO GRANDE CITY       TX       26.3769   -98.8117

   3 │   771  79-0043  BROWNSVILLE           TX       25.9156   -97.4186

   4 │   772  79-0045  SAN ANTONIO INTL AP   TX       29.5442   -98.4839

   5 │   807  79-0125  EL PASO               TX       31.7587  -106.484        ⋯

   6 │   147  41-1007  BRACKETTVILLE         TX       29.3167  -100.414

   7 │   306  41-3270  FORT MCKAVETT         TX       30.9303  -100.112

   8 │   808  79-0126  FT STOCKTON PECOS AP  TX       30.9119  -102.917

   9 │   303  41-3265  FT GRIFFIN            TX       32.9236   -99.2225       ⋯

  10 │   779  79-0055  GALVESTON             TX       29.3048   -94.7934

  11 │   301  41-3257  FT MCKAVETT           TX       30.8275  -100.11

  12 │   812  79-0153  PALESTINE 2 NE        TX       31.7831   -95.6039

  13 │   723  41-9532  WEATHERFORD           TX       32.7483   -97.77         ⋯

  14 │   222  41-2014  CORPUS CHRISTI        TX       27.8      -97.4

  15 │   289  41-3156  FISCHERS STORE        TX       29.9756   -98.2647

<span class="ansi-cyan-fg">                                                                1 column omitted</span></pre>
</div>
</div>
</div>
<div id="9824e4e4" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>my_stnid <span class="op">=</span> <span class="fl">112</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>austin_station <span class="op">=</span> <span class="pp">@chain</span> stations <span class="cf">begin</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@filter</span>(stnid <span class="op">==</span> !!my_stnid)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    first</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>austin_precip <span class="op">=</span> <span class="pp">@chain</span> rainfall_data <span class="cf">begin</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@filter</span>(stnid <span class="op">==</span> !!my_stnid)</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@arrange</span>(date)</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span> </span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>rainfall_conversion <span class="op">=</span> Makie.<span class="fu">UnitfulConversion</span>(u<span class="st">"inch"</span>)</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">plot_time_series</span>(station_row, rainfall_df)</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> <span class="fu">Figure</span>(size <span class="op">=</span> (<span class="fl">800</span>, <span class="fl">400</span>))</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>    ax <span class="op">=</span> <span class="fu">Axis</span>(fig[<span class="fl">1</span>, <span class="fl">1</span>],</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>        ylabel <span class="op">=</span> <span class="st">"Annual Maximum 24-Hour Rainfall [inch]"</span>,</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>        title <span class="op">=</span> <span class="st">"</span><span class="sc">$</span>(station_row.noaa_id)<span class="st">: </span><span class="sc">$</span>(station_row.name)<span class="st">"</span>,</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>        dim2_conversion <span class="op">=</span> rainfall_conversion)</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lines!</span>(ax, rainfall_df.date, rainfall_df.rainfall, color <span class="op">=</span> <span class="op">:</span>blue, linewidth <span class="op">=</span> <span class="fl">2</span>)</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scatter!</span>(ax, rainfall_df.date, rainfall_df.rainfall, markersize <span class="op">=</span> <span class="fl">10</span>, marker <span class="op">=</span> <span class="op">:</span>circle, strokewidth <span class="op">=</span> <span class="fl">2</span>, color <span class="op">=</span> <span class="op">:</span>transparent)</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>    fig</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_time_series</span>(austin_station, austin_precip)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<div class="ansi-escaped-output">
<pre><span class="ansi-yellow-fg ansi-bold">┌ </span><span class="ansi-yellow-fg ansi-bold">Warning: </span>Found `resolution` in the theme when creating a `Scene`. The `resolution` keyword for `Scene`s and `Figure`s has been deprecated. Use `Figure(; size = ...` or `Scene(; size = ...)` instead, which better reflects that this is a unitless size and not a pixel resolution. The key could also come from `set_theme!` calls or related theming functions.

<span class="ansi-yellow-fg ansi-bold">└ </span><span class="ansi-bright-black-fg">@ Makie ~/.julia/packages/Makie/4JW9B/src/scenes.jl:264</span>
</pre>
</div>
</div>
<div class="cell-output cell-output-display" data-execution_count="8">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-8-output-2.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="bayesian-mle-approach-with-turing.jl" class="level3" data-number="0.2">
<h3 data-number="0.2" class="anchored" data-anchor-id="bayesian-mle-approach-with-turing.jl"><span class="header-section-number">0.2</span> Bayesian MLE Approach with Turing.jl</h3>
<div id="f814e86d" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>precip <span class="op">=</span> <span class="fu">collect</span>(<span class="fu">skipmissing</span>(<span class="fu">ustrip</span>.(u<span class="st">"inch"</span>, austin_precip.rainfall)))</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Define Bayesian GEV model and priors based on data</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">gev_model</span>(precip)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    μ <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">2</span>, <span class="fl">1</span>)           </span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    log_σ <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">1.0</span>, <span class="fl">0.5</span>) <span class="co">#A little less than most of the data is near μ    </span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    ξ <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0.1</span>, <span class="fl">0.1</span>) <span class="co">#Data has some extremes but those are spaced out, slightly heavy tail        </span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    σ <span class="op">=</span> <span class="fu">exp</span>(log_σ)              </span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    precip <span class="op">.~</span> <span class="fu">GeneralizedExtremeValue</span>(μ, σ, ξ) </span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>austin_MLE_Turing <span class="op">=</span> <span class="fu">maximum_likelihood</span>(<span class="fu">gev_model</span>(precip), <span class="fu">NelderMead</span>(); initial_params <span class="op">=</span> [<span class="fl">5</span>, <span class="fl">0.5</span>, <span class="fl">0</span>])</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>μ_turing <span class="op">=</span> austin_MLE_Turing.values[<span class="op">:</span>μ]           </span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>σ_turing <span class="op">=</span> <span class="fu">exp</span>(austin_MLE_Turing.values[<span class="op">:</span>log_σ])  </span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>ξ_turing <span class="op">=</span> austin_MLE_Turing.values[<span class="op">:</span>ξ] </span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>turing_params <span class="op">=</span> <span class="fu">DataFrame</span>(</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>    Parameter <span class="op">=</span> [<span class="st">"Location (μ)"</span>, <span class="st">"Scale (σ)"</span>, <span class="st">"Shape (ξ)"</span>],</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>    Value <span class="op">=</span> [<span class="fu">round</span>(μ_turing, digits <span class="op">=</span> <span class="fl">3</span>), <span class="fu">round</span>(σ_turing, digits <span class="op">=</span> <span class="fl">3</span>), <span class="fu">round</span>(ξ_turing, digits <span class="op">=</span> <span class="fl">3</span>)],</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a><span class="fu">println</span>(<span class="st">"GEV Parameters [Turing.jl]:"</span>)</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>turing_params</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>turing_dist <span class="op">=</span> <span class="fu">GeneralizedExtremeValue</span>(μ_turing, σ_turing, ξ_turing)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>GEV Parameters [Turing.jl]:</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>GeneralizedExtremeValue{Float64}(μ=2.891044788062331, σ=1.1495015022417774, ξ=0.2781268027262154)</code></pre>
</div>
</div>
</section>
<section id="mle-implementation-with-extremes.jl" class="level3" data-number="0.3">
<h3 data-number="0.3" class="anchored" data-anchor-id="mle-implementation-with-extremes.jl"><span class="header-section-number">0.3</span> MLE Implementation with Extremes.jl</h3>
<div id="92f6bd53" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Fit the GEV with MLE</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>austin_MLE_Extreme <span class="op">=</span> <span class="fu">gevfit</span>(precip)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Parameters into a data fram</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>μ_extremes <span class="op">=</span> <span class="fu">location</span>(austin_MLE_Extreme)[<span class="fl">1</span>]  </span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>σ_extremes <span class="op">=</span> <span class="fu">scale</span>(austin_MLE_Extreme)[<span class="fl">1</span>]       </span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>ξ_extremes <span class="op">=</span> <span class="fu">shape</span>(austin_MLE_Extreme)[<span class="fl">1</span>]     </span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>extreme_params <span class="op">=</span> <span class="fu">DataFrame</span>(</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    Parameter <span class="op">=</span> [<span class="st">"Location (μ)"</span>, <span class="st">"Scale (σ)"</span>, <span class="st">"Shape (ξ)"</span>],</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>   Value <span class="op">=</span> [<span class="fu">round</span>(μ_extremes, digits <span class="op">=</span> <span class="fl">3</span>), <span class="fu">round</span>(σ_extremes, digits <span class="op">=</span> <span class="fl">3</span>), <span class="fu">round</span>(ξ_extremes, digits <span class="op">=</span> <span class="fl">3</span>)],</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="fu">println</span>(<span class="st">"GEV Parameters [Extremes.jl]:"</span>)</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>extreme_params</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>extremes_dist <span class="op">=</span> <span class="fu">GeneralizedExtremeValue</span>(μ_extremes, σ_extremes, ξ_extremes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>GEV Parameters [Extremes.jl]:</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre><code>GeneralizedExtremeValue{Float64}(μ=2.891053596482406, σ=1.1495039717643978, ξ=0.2781135502814854)</code></pre>
</div>
</div>
</section>
<section id="benchmark-of-turing-mle-using-extremes-mle" class="level3" data-number="0.4">
<h3 data-number="0.4" class="anchored" data-anchor-id="benchmark-of-turing-mle-using-extremes-mle"><span class="header-section-number">0.4</span> Benchmark of Turing MLE using Extremes MLE</h3>
<div id="04bc7952" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>params_comparison <span class="op">=</span> <span class="fu">DataFrame</span>(</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    Method <span class="op">=</span> [<span class="st">"Extremes MLE"</span>, <span class="st">"Turing MLE"</span>],</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    μ <span class="op">=</span> [<span class="fu">round</span>(μ_extremes, digits <span class="op">=</span> <span class="fl">3</span>), <span class="fu">round</span>(μ_turing, digits <span class="op">=</span> <span class="fl">3</span>)],</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    σ <span class="op">=</span> [<span class="fu">round</span>(σ_extremes, digits <span class="op">=</span> <span class="fl">3</span>), <span class="fu">round</span>(σ_turing, digits <span class="op">=</span> <span class="fl">3</span>)],</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    ξ <span class="op">=</span> [<span class="fu">round</span>(ξ_extremes, digits <span class="op">=</span> <span class="fl">3</span>), <span class="fu">round</span>(ξ_turing, digits <span class="op">=</span> <span class="fl">3</span>)],</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>params_comparison</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare return levels</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>return_periods <span class="op">=</span> [<span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">25</span>, <span class="fl">50</span>, <span class="fl">100</span>]</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>return_levels_comparison <span class="op">=</span> <span class="fu">DataFrame</span>(</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    T_years <span class="op">=</span> return_periods,</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>    Extremes_MLE <span class="op">=</span> [<span class="fu">round</span>(<span class="fu">quantile</span>(extremes_dist, <span class="fl">1</span> <span class="op">-</span> <span class="fl">1</span> <span class="op">/</span> T), digits <span class="op">=</span> <span class="fl">2</span>) for T <span class="kw">in</span> return_periods],</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>    Turing_MLE <span class="op">=</span> [<span class="fu">round</span>(<span class="fu">quantile</span>(turing_dist, <span class="fl">1</span> <span class="op">-</span> <span class="fl">1</span> <span class="op">/</span> T), digits <span class="op">=</span> <span class="fl">2</span>) for T <span class="kw">in</span> return_periods],</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>return_levels_comparison</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a><span class="co">#Turing likelihood is accurate as parameters match</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<div><div style="float: left;"><span>5×3 DataFrame</span></div><div style="clear: both;"></div></div><div class="data-frame" style="overflow-x: scroll;">
<table class="data-frame caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th class="rowNumber" data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;">Row</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">T_years</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Extremes_MLE</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Turing_MLE</th>
</tr>
<tr class="subheader headerLastRow even">
<th class="rowNumber" data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Int64">Int64</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Float64">Float64</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Float64">Float64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5.03</td>
<td style="text-align: right;">5.03</td>
</tr>
<tr class="even">
<td class="rowNumber" style="text-align: right; font-weight: bold;">2</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">6.49</td>
<td style="text-align: right;">6.49</td>
</tr>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">3</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">8.82</td>
<td style="text-align: right;">8.82</td>
</tr>
<tr class="even">
<td class="rowNumber" style="text-align: right; font-weight: bold;">4</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">10.99</td>
<td style="text-align: right;">10.99</td>
</tr>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">5</td>
<td style="text-align: right;">100</td>
<td style="text-align: right;">13.61</td>
<td style="text-align: right;">13.61</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="c95080e1" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">plot_gev_comparison</span>(station_data, extremes_dist, turing_dist, station_info)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> <span class="fu">Figure</span>()</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    ax <span class="op">=</span> <span class="fu">Axis</span>(fig[<span class="fl">1</span>, <span class="fl">1</span>],</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>        xlabel <span class="op">=</span> <span class="st">"Return Period (years)"</span>,</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>        ylabel <span class="op">=</span> <span class="st">"Return Level (inches)"</span>,</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>        title <span class="op">=</span> <span class="st">"GEV Fit Comparison</span><span class="sc">\n$</span>(station_info.noaa_id)<span class="st">: </span><span class="sc">$</span>(station_info.name)<span class="st">"</span>,</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>        xscale <span class="op">=</span> log10)  </span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">create_return_period_range</span>(min_period<span class="op">=</span><span class="fl">1.1</span>, max_period<span class="op">=</span><span class="fl">250</span>, n_points<span class="op">=</span><span class="fl">100</span>)</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fl">10</span> <span class="op">.^</span> <span class="fu">range</span>(<span class="fu">log10</span>(min_period), <span class="fu">log10</span>(max_period), length<span class="op">=</span>n_points)</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>    T_smooth <span class="op">=</span> <span class="fu">create_return_period_range</span>(<span class="fl">1.1</span>, <span class="fl">250</span>, <span class="fl">100</span>) </span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extremes.jl MLE curve</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>    levels_extremes <span class="op">=</span> [<span class="fu">quantile</span>(extremes_dist, <span class="fl">1</span> <span class="op">-</span> <span class="fl">1</span> <span class="op">/</span> T) for T <span class="kw">in</span> T_smooth]  </span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lines!</span>(ax, T_smooth, levels_extremes, color <span class="op">=</span> <span class="op">:</span>blue, linewidth <span class="op">=</span> <span class="fl">2</span>, label <span class="op">=</span> <span class="st">"Extremes MLE"</span>)</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Turing.jl curve  </span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>    levels_turing <span class="op">=</span> [<span class="fu">quantile</span>(turing_dist, <span class="fl">1</span> <span class="op">-</span> <span class="fl">1</span> <span class="op">/</span> T) for T <span class="kw">in</span> T_smooth]  </span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lines!</span>(ax, T_smooth, levels_turing, color <span class="op">=</span> <span class="op">:</span>red, linewidth <span class="op">=</span> <span class="fl">2</span>, linestyle <span class="op">=</span> <span class="op">:</span>dash, label <span class="op">=</span> <span class="st">"Turing MLE"</span>)</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Empirical data points</span></span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>    emp_levels, emp_periods <span class="op">=</span> <span class="fu">weibull_plotting_positions</span>(station_data.rainfall) </span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scatter!</span>(ax, emp_periods, emp_levels,</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>        color <span class="op">=</span> <span class="op">:</span>black, markersize <span class="op">=</span> <span class="fl">8</span>, marker <span class="op">=</span> <span class="op">:</span>circle,</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>        label <span class="op">=</span> <span class="st">"Observed Data"</span>)</span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Standard return periods</span></span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>    return_periods <span class="op">=</span> [<span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">25</span>, <span class="fl">50</span>, <span class="fl">100</span>, <span class="fl">250</span>]</span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>    ax.xticks <span class="op">=</span> return_periods  </span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">axislegend</span>(ax, position <span class="op">=</span> <span class="op">:</span>rb)  </span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> fig</span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_gev_comparison</span>(austin_precip, extremes_dist, turing_dist, austin_station)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<div class="ansi-escaped-output">
<pre><span class="ansi-yellow-fg ansi-bold">┌ </span><span class="ansi-yellow-fg ansi-bold">Warning: </span>Found `resolution` in the theme when creating a `Scene`. The `resolution` keyword for `Scene`s and `Figure`s has been deprecated. Use `Figure(; size = ...` or `Scene(; size = ...)` instead, which better reflects that this is a unitless size and not a pixel resolution. The key could also come from `set_theme!` calls or related theming functions.

<span class="ansi-yellow-fg ansi-bold">└ </span><span class="ansi-bright-black-fg">@ Makie ~/.julia/packages/Makie/4JW9B/src/scenes.jl:264</span>
</pre>
</div>
</div>
<div class="cell-output cell-output-display" data-execution_count="12">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-12-output-2.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="bayesian-inference-with-mcmc" class="level3" data-number="0.5">
<h3 data-number="0.5" class="anchored" data-anchor-id="bayesian-inference-with-mcmc"><span class="header-section-number">0.5</span> Bayesian Inference with MCMC</h3>
<p><em>Using the return level method as I feel I have a good understanding of rainfall in Austin, priors are based on Austin dataset and set up to follow data trends. Return levels were assumed based on looking at the scatterplot of data</em></p>
<div id="dae13362" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">load_or_sample</span>(fname, model; overwrite<span class="op">=</span><span class="cn">false</span>, n_chains<span class="op">=</span><span class="fl">4</span>, samples_per_chain<span class="op">=</span><span class="fl">2000</span>, sampler<span class="op">=</span><span class="fu">NUTS</span>(), threading<span class="op">=</span><span class="fu">MCMCThreads</span>(), rng<span class="op">=</span>rng)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    idata <span class="op">=</span> <span class="cf">try</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@assert</span> !overwrite <span class="st">"Reading from cache disabled by overwrite=true"</span>  </span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>        idata <span class="op">=</span> ArviZ.<span class="fu">from_netcdf</span>(fname)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@info</span> <span class="st">"Loaded cached prior samples from </span><span class="sc">$</span>fname<span class="st">"</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> idata</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">catch</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>        chains <span class="op">=</span> <span class="fu">sample</span>(</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>            model,</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>            sampler,</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>            threading,</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>            <span class="fu">Int</span>(<span class="fu">ceil</span>(samples_per_chain <span class="op">*</span> n_chains)),  </span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>            n_chains,</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>            verbose<span class="op">=</span><span class="cn">false</span>,</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>        idata <span class="op">=</span> ArviZ.<span class="fu">from_mcmcchains</span>(chains)</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>        ArviZ.<span class="fu">to_netcdf</span>(idata, fname)</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@info</span> <span class="st">"Sampled and cached prior samples to </span><span class="sc">$</span>fname<span class="st">"</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> idata</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>load_or_sample (generic function with 1 method)</code></pre>
</div>
</div>
<p><em>Return levels estimated based on data scatterplot</em></p>
<div id="cc8cf95a" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>return_level_priors <span class="op">=</span> [</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ReturnLevelPrior</span>(<span class="fl">2</span>, <span class="fl">2.0</span>, <span class="fl">1.0</span>),</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ReturnLevelPrior</span>(<span class="fl">10</span>, <span class="fl">4.0</span>, <span class="fl">2.5</span>),</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ReturnLevelPrior</span>(<span class="fl">50</span>, <span class="fl">10.0</span>, <span class="fl">6</span>),</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ReturnLevelPrior</span>(<span class="fl">100</span>, <span class="fl">12.0</span>, <span class="fl">8</span>),</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre><code>4-element Vector{ReturnLevelPrior}:
 ReturnLevelPrior(0.5, InverseGamma{Float64}(
invd: Gamma{Float64}(α=6.0, θ=0.1)
θ: 10.0
)
)
 ReturnLevelPrior(0.9, InverseGamma{Float64}(
invd: Gamma{Float64}(α=4.5600000000000005, θ=0.07022471910112359)
θ: 14.240000000000002
)
)
 ReturnLevelPrior(0.98, InverseGamma{Float64}(
invd: Gamma{Float64}(α=4.777777777777778, θ=0.026470588235294117)
θ: 37.77777777777778
)
)
 ReturnLevelPrior(0.99, InverseGamma{Float64}(
invd: Gamma{Float64}(α=4.25, θ=0.02564102564102564)
θ: 39.0
)
)</code></pre>
</div>
</div>
<div id="d4c4e103" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>fig_priorDist <span class="op">=</span> <span class="kw">let</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>    rts <span class="op">=</span> <span class="fu">logrange</span>(<span class="fl">1.1</span>, <span class="fl">250</span>, <span class="fl">500</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    xticks <span class="op">=</span> [<span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">25</span>, <span class="fl">50</span>, <span class="fl">100</span>, <span class="fl">250</span>]</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> <span class="fu">Figure</span>(size<span class="op">=</span>(<span class="fl">1200</span>, <span class="fl">600</span>))</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    ax <span class="op">=</span> <span class="fu">Axis</span>(fig[<span class="fl">1</span>, <span class="fl">1</span>], xlabel<span class="op">=</span><span class="st">"Return Period (years)"</span>, ylabel<span class="op">=</span><span class="st">"Return Level (inches)"</span>, title<span class="op">=</span><span class="st">"Prior Predictive Distribution"</span>, xscale<span class="op">=</span>log10, xticks<span class="op">=</span>xticks)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">posterior_bands!</span>(ax, prior_GEVs, rts; color<span class="op">=</span>(<span class="op">:</span>blue, <span class="fl">0.2</span>), ci<span class="op">=</span><span class="fl">0.90</span>)</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">posterior_mean_curve!</span>(ax, prior_GEVs, rts; color<span class="op">=:</span>blue, linewidth<span class="op">=</span><span class="fl">3</span>)</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    fig</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<div class="ansi-escaped-output">
<pre><span class="ansi-yellow-fg ansi-bold">┌ </span><span class="ansi-yellow-fg ansi-bold">Warning: </span>Found `resolution` in the theme when creating a `Scene`. The `resolution` keyword for `Scene`s and `Figure`s has been deprecated. Use `Figure(; size = ...` or `Scene(; size = ...)` instead, which better reflects that this is a unitless size and not a pixel resolution. The key could also come from `set_theme!` calls or related theming functions.

<span class="ansi-yellow-fg ansi-bold">└ </span><span class="ansi-bright-black-fg">@ Makie ~/.julia/packages/Makie/4JW9B/src/scenes.jl:264</span>
</pre>
</div>
</div>
<div class="cell-output cell-output-display" data-execution_count="16">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-16-output-2.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="27078068" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="annotated-cell-14"><pre class="sourceCode julia code-annotation-code code-with-copy"><code class="sourceCode julia"><span id="annotated-cell-14-1"><a href="#annotated-cell-14-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">gev_model_quantile_priors</span>(y; return_level_priors<span class="op">=</span>[])</span>
<span id="annotated-cell-14-2"><a href="#annotated-cell-14-2" aria-hidden="true" tabindex="-1"></a>    μ <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">2</span>, <span class="fl">1</span>)           </span>
<span id="annotated-cell-14-3"><a href="#annotated-cell-14-3" aria-hidden="true" tabindex="-1"></a>    log_σ <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">1.0</span>, <span class="fl">0.5</span>)  </span>
<span id="annotated-cell-14-4"><a href="#annotated-cell-14-4" aria-hidden="true" tabindex="-1"></a>    ξ <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0.1</span>, <span class="fl">0.1</span>)</span>
<span id="annotated-cell-14-5"><a href="#annotated-cell-14-5" aria-hidden="true" tabindex="-1"></a>    σ <span class="op">=</span> <span class="fu">exp</span>(log_σ)</span>
<span id="annotated-cell-14-6"><a href="#annotated-cell-14-6" aria-hidden="true" tabindex="-1"></a>    dist <span class="op">=</span> <span class="fu">GeneralizedExtremeValue</span>(μ, σ, ξ)</span>
<span id="annotated-cell-14-7"><a href="#annotated-cell-14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-14-8"><a href="#annotated-cell-14-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> prior <span class="kw">in</span> return_level_priors</span>
<span id="annotated-cell-14-9"><a href="#annotated-cell-14-9" aria-hidden="true" tabindex="-1"></a>        rl <span class="op">=</span> <span class="fu">quantile</span>(dist, prior.quantile)</span>
<span id="annotated-cell-14-10"><a href="#annotated-cell-14-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> rl <span class="op">&gt;</span> <span class="fl">0.1</span> </span>
<span id="annotated-cell-14-11"><a href="#annotated-cell-14-11" aria-hidden="true" tabindex="-1"></a>        Turing.<span class="pp">@addlogprob</span>!(<span class="fu">loglikelihood</span>(prior.distribution, rl))</span>
<span id="annotated-cell-14-12"><a href="#annotated-cell-14-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span></span>
<span id="annotated-cell-14-13"><a href="#annotated-cell-14-13" aria-hidden="true" tabindex="-1"></a>            Turing.<span class="pp">@addlogprob</span>!(<span class="op">-</span><span class="cn">Inf</span>)</span>
<span id="annotated-cell-14-14"><a href="#annotated-cell-14-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="annotated-cell-14-15"><a href="#annotated-cell-14-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="annotated-cell-14-16"><a href="#annotated-cell-14-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-14-17"><a href="#annotated-cell-14-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="fu">length</span>(y) <span class="op">&gt;</span> <span class="fl">0</span> </span>
<span id="annotated-cell-14-18"><a href="#annotated-cell-14-18" aria-hidden="true" tabindex="-1"></a>        y <span class="op">.~</span> dist</span>
<span id="annotated-cell-14-19"><a href="#annotated-cell-14-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="annotated-cell-14-20"><a href="#annotated-cell-14-20" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="annotated-cell-14-21"><a href="#annotated-cell-14-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-14-22"><a href="#annotated-cell-14-22" aria-hidden="true" tabindex="-1"></a>prior_idata <span class="op">=</span> <span class="kw">let</span></span>
<span id="annotated-cell-14-23"><a href="#annotated-cell-14-23" aria-hidden="true" tabindex="-1"></a>    fname <span class="op">=</span> <span class="fu">joinpath</span>(lab_dir, <span class="st">"prior.nc"</span>)</span>
<span id="annotated-cell-14-24"><a href="#annotated-cell-14-24" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> <span class="fu">gev_model_quantile_priors</span>([]; return_level_priors<span class="op">=</span>return_level_priors)</span>
<span id="annotated-cell-14-25"><a href="#annotated-cell-14-25" aria-hidden="true" tabindex="-1"></a>    overwrite <span class="op">=</span> <span class="cn">true</span></span>
<span id="annotated-cell-14-26"><a href="#annotated-cell-14-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">load_or_sample</span>(fname, model; overwrite<span class="op">=</span><span class="cn">false</span>)</span>
<span id="annotated-cell-14-27"><a href="#annotated-cell-14-27" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="annotated-cell-14-28"><a href="#annotated-cell-14-28" aria-hidden="true" tabindex="-1"></a>prior_GEVs <span class="op">=</span> <span class="fu">vec</span>(<span class="fu">GeneralizedExtremeValue</span>.(prior_idata.posterior.μ, <span class="fu">exp</span>.(prior_idata.posterior.log_σ), prior_idata.posterior.ξ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<div class="ansi-escaped-output">
<pre><span class="ansi-cyan-fg ansi-bold">[ </span><span class="ansi-cyan-fg ansi-bold">Info: </span>Loaded cached prior samples from prior.nc
</pre>
</div>
</div>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre><code>32000-element Vector{GeneralizedExtremeValue{Float64}}:
 GeneralizedExtremeValue{Float64}(μ=2.136032557857292, σ=2.0900525024680348, ξ=-0.29174348978795495)
 GeneralizedExtremeValue{Float64}(μ=2.3586318304847276, σ=1.9509444753120517, ξ=-0.07851985503984037)
 GeneralizedExtremeValue{Float64}(μ=1.5123211126164944, σ=1.5337828410900112, ξ=-0.18296940998702585)
 GeneralizedExtremeValue{Float64}(μ=2.8447392955353394, σ=2.4823070388975954, ξ=-0.35948843611659453)
 GeneralizedExtremeValue{Float64}(μ=4.230822721919236, σ=1.8894668019213223, ξ=-0.12158323520348957)
 GeneralizedExtremeValue{Float64}(μ=3.7604891319386824, σ=1.2852692117842246, ξ=-0.16573097360447953)
 GeneralizedExtremeValue{Float64}(μ=4.074497863461621, σ=3.1692433680830794, ξ=-0.2048641063301066)
 GeneralizedExtremeValue{Float64}(μ=4.16231399697262, σ=4.171510481119265, ξ=-0.1975152149631089)
 GeneralizedExtremeValue{Float64}(μ=1.9586674909719215, σ=1.499154062883712, ξ=-0.6816930279462787)
 GeneralizedExtremeValue{Float64}(μ=3.1364689365647878, σ=2.784348203315226, ξ=-0.0986802344583565)
 GeneralizedExtremeValue{Float64}(μ=1.5762706623228713, σ=3.050569902554789, ξ=-0.5147296946743278)
 GeneralizedExtremeValue{Float64}(μ=2.1607759418732635, σ=3.5501383165897322, ξ=-0.5568052459691908)
 GeneralizedExtremeValue{Float64}(μ=1.4079010034423802, σ=3.5918608062467223, ξ=-0.568660953664076)
 ⋮
 GeneralizedExtremeValue{Float64}(μ=4.399840225743612, σ=2.3015370526990564, ξ=-0.4617197303372459)
 GeneralizedExtremeValue{Float64}(μ=3.248801961251549, σ=1.8140652851508905, ξ=-0.3681538003319502)
 GeneralizedExtremeValue{Float64}(μ=3.40609231047962, σ=2.820487391843296, ξ=-0.3962745660747572)
 GeneralizedExtremeValue{Float64}(μ=2.281909936613401, σ=2.071391284056437, ξ=-0.6028110347559527)
 GeneralizedExtremeValue{Float64}(μ=0.5126224087536788, σ=2.08719284843627, ξ=-0.18189377124660783)
 GeneralizedExtremeValue{Float64}(μ=2.085688267466457, σ=2.1294687189384276, ξ=0.06187230922460798)
 GeneralizedExtremeValue{Float64}(μ=0.9233963655923605, σ=2.6680829132333606, ξ=-0.34186054618485767)
 GeneralizedExtremeValue{Float64}(μ=0.979253429770262, σ=2.2377544478591047, ξ=-0.24346622774478732)
 GeneralizedExtremeValue{Float64}(μ=2.7774140209238074, σ=2.3931263809068852, ξ=-0.259619933546178)
 GeneralizedExtremeValue{Float64}(μ=2.068847228557591, σ=3.0456099707591497, ξ=-0.1673759348199716)
 GeneralizedExtremeValue{Float64}(μ=1.214125506221892, σ=2.6518980942621653, ξ=-0.2179579080280881)
 GeneralizedExtremeValue{Float64}(μ=1.2447415911536701, σ=3.42575295715908, ξ=-0.49048461829062207)</code></pre>
</div>
</div>
</section>
<section id="posterior-distribution-vs-mle-results" class="level3" data-number="0.6">
<h3 data-number="0.6" class="anchored" data-anchor-id="posterior-distribution-vs-mle-results"><span class="header-section-number">0.6</span> Posterior Distribution vs MLE Results</h3>
<div id="e7410654" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>y_obs <span class="op">=</span> <span class="fu">collect</span>(<span class="fu">skipmissing</span>(<span class="fu">ustrip</span>.(u<span class="st">"inch"</span>, austin_precip.rainfall)))</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>bayes <span class="op">=</span> <span class="fu">gev_model_quantile_priors</span>(y_obs; return_level_priors<span class="op">=</span>return_level_priors)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<pre><code>DynamicPPL.Model{typeof(gev_model_quantile_priors), (:y,), (:return_level_priors,), (), Tuple{Vector{Float64}}, Tuple{Vector{ReturnLevelPrior}}, DynamicPPL.DefaultContext}(Main.gev_model_quantile_priors, (y = [7.0, 3.25, 3.45, 1.95, 8.02, 3.0, 2.85, 4.0, 2.67, 5.0  …  1.77, 3.77, 4.92, 2.14, 3.23, 5.06, 4.31, 9.36, 3.04, 7.32],), (return_level_priors = ReturnLevelPrior[ReturnLevelPrior(0.5, InverseGamma{Float64}(
invd: Gamma{Float64}(α=6.0, θ=0.1)
θ: 10.0
)
), ReturnLevelPrior(0.9, InverseGamma{Float64}(
invd: Gamma{Float64}(α=4.5600000000000005, θ=0.07022471910112359)
θ: 14.240000000000002
)
), ReturnLevelPrior(0.98, InverseGamma{Float64}(
invd: Gamma{Float64}(α=4.777777777777778, θ=0.026470588235294117)
θ: 37.77777777777778
)
), ReturnLevelPrior(0.99, InverseGamma{Float64}(
invd: Gamma{Float64}(α=4.25, θ=0.02564102564102564)
θ: 39.0
)
)],), DynamicPPL.DefaultContext())</code></pre>
</div>
</div>
<div id="5ac34931" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>mle_estimate <span class="op">=</span> <span class="fu">maximum_likelihood</span>(bayes, <span class="fu">NelderMead</span>(); maxiters<span class="op">=</span><span class="fl">1_000</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>mle_dist <span class="op">=</span> <span class="fu">GeneralizedExtremeValue</span>(mle_estimate.values[<span class="fl">1</span>], <span class="fu">exp</span>(mle_estimate.values[<span class="fl">2</span>]), mle_estimate.values[<span class="fl">3</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<pre><code>GeneralizedExtremeValue{Float64}(μ=2.8582897990047655, σ=1.1007282296087295, ξ=0.2367332734826068)</code></pre>
</div>
</div>
<div id="5cbc9a28" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>posterior_idata <span class="op">=</span> <span class="kw">let</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>    fname <span class="op">=</span> <span class="fu">joinpath</span>(lab_dir, <span class="st">"posterior_data.nc"</span>)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    overwrite <span class="op">=</span> <span class="cn">true</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">load_or_sample</span>(fname, bayes; overwrite<span class="op">=</span>overwrite)</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>posterior_GEVs <span class="op">=</span> <span class="fu">vec</span>(<span class="fu">GeneralizedExtremeValue</span>.(posterior_idata.posterior.μ, <span class="fu">exp</span>.(posterior_idata.posterior.log_σ), posterior_idata.posterior.ξ))</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>post_summary <span class="op">=</span> ArviZ.<span class="fu">summarize</span>(posterior_idata)</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>post_summary</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<div class="ansi-escaped-output">
<pre><span class="ansi-yellow-fg ansi-bold">┌ </span><span class="ansi-yellow-fg ansi-bold">Warning: </span>Only a single thread available: MCMC chains are not sampled in parallel

<span class="ansi-yellow-fg ansi-bold">└ </span><span class="ansi-bright-black-fg">@ AbstractMCMC ~/.julia/packages/AbstractMCMC/nQLlh/src/sample.jl:410</span>


<span class="ansi-green-fg">Sampling (1 thread):   2%|▌                             |  ETA: 0:00:09</span>

<span class="ansi-green-fg">Sampling (1 thread):   7%|██▏                           |  ETA: 0:00:12</span>

<span class="ansi-green-fg">Sampling (1 thread):  12%|███▌                          |  ETA: 0:00:09</span>

<span class="ansi-green-fg">Sampling (1 thread):  16%|█████                         |  ETA: 0:00:08</span>

<span class="ansi-green-fg">Sampling (1 thread):  20%|██████                        |  ETA: 0:00:07</span>

<span class="ansi-green-fg">Sampling (1 thread):  22%|██████▊                       |  ETA: 0:00:07</span>

<span class="ansi-green-fg">Sampling (1 thread):  25%|███████▌                      |  ETA: 0:00:10</span>

<span class="ansi-green-fg">Sampling (1 thread):  28%|████████▎                     |  ETA: 0:00:10</span>

<span class="ansi-green-fg">Sampling (1 thread):  30%|█████████                     |  ETA: 0:00:09</span>

<span class="ansi-green-fg">Sampling (1 thread):  32%|█████████▊                    |  ETA: 0:00:09</span>

<span class="ansi-green-fg">Sampling (1 thread):  35%|██████████▌                   |  ETA: 0:00:08</span>

<span class="ansi-green-fg">Sampling (1 thread):  38%|███████████▎                  |  ETA: 0:00:08</span>

<span class="ansi-green-fg">Sampling (1 thread):  40%|████████████                  |  ETA: 0:00:07</span>

<span class="ansi-green-fg">Sampling (1 thread):  42%|████████████▊                 |  ETA: 0:00:07</span>

<span class="ansi-green-fg">Sampling (1 thread):  45%|█████████████▌                |  ETA: 0:00:06</span>

<span class="ansi-green-fg">Sampling (1 thread):  48%|██████████████▎               |  ETA: 0:00:06</span>

<span class="ansi-green-fg">Sampling (1 thread):  50%|███████████████               |  ETA: 0:00:06</span>

<span class="ansi-green-fg">Sampling (1 thread):  58%|█████████████████▎            |  ETA: 0:00:05</span>

<span class="ansi-green-fg">Sampling (1 thread):  60%|██████████████████            |  ETA: 0:00:05</span>

<span class="ansi-green-fg">Sampling (1 thread):  62%|██████████████████▊           |  ETA: 0:00:04</span>

<span class="ansi-green-fg">Sampling (1 thread):  65%|███████████████████▌          |  ETA: 0:00:04</span>

<span class="ansi-green-fg">Sampling (1 thread):  68%|████████████████████▎         |  ETA: 0:00:04</span>

<span class="ansi-green-fg">Sampling (1 thread):  70%|█████████████████████         |  ETA: 0:00:03</span>

<span class="ansi-green-fg">Sampling (1 thread):  72%|█████████████████████▊        |  ETA: 0:00:03</span>

<span class="ansi-green-fg">Sampling (1 thread):  75%|██████████████████████▌       |  ETA: 0:00:03</span>

<span class="ansi-green-fg">Sampling (1 thread):  78%|███████████████████████▎      |  ETA: 0:00:02</span>

<span class="ansi-green-fg">Sampling (1 thread):  80%|████████████████████████      |  ETA: 0:00:02</span>

<span class="ansi-green-fg">Sampling (1 thread):  82%|████████████████████████▊     |  ETA: 0:00:02</span>

<span class="ansi-green-fg">Sampling (1 thread):  85%|█████████████████████████▌    |  ETA: 0:00:02</span>

<span class="ansi-green-fg">Sampling (1 thread):  88%|██████████████████████████▎   |  ETA: 0:00:01</span>

<span class="ansi-green-fg">Sampling (1 thread):  90%|███████████████████████████   |  ETA: 0:00:01</span>

<span class="ansi-green-fg">Sampling (1 thread):  92%|███████████████████████████▊  |  ETA: 0:00:01</span>

<span class="ansi-green-fg">Sampling (1 thread):  95%|████████████████████████████▌ |  ETA: 0:00:01</span>

<span class="ansi-green-fg">Sampling (1 thread):  98%|█████████████████████████████▎|  ETA: 0:00:00</span>

<span class="ansi-green-fg">Sampling (1 thread): 100%|██████████████████████████████| Time: 0:00:10</span>

<span class="ansi-cyan-fg ansi-bold">[ </span><span class="ansi-cyan-fg ansi-bold">Info: </span>Sampled and cached prior samples to posterior_data.nc
</pre>
</div>
</div>
<div class="cell-output cell-output-display" data-execution_count="19">
<table class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<caption>SummaryStats</caption>
<thead>
<tr class="header headerLastRow">
<th class="rowLabel" data-quarto-table-cell-role="th" style="text-align: left; font-weight: bold;"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th">mean</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">std</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">eti89</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">ess_tail</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">ess_bulk</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">rhat</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">mcse_mean</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">mcse_std</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td class="rowLabel" style="text-align: left; font-weight: bold;">μ</td>
<td style="text-align: right;">2.889</td>
<td style="text-align: right;">0.113</td>
<td style="text-align: left;">2.71 .. 3.07</td>
<td style="text-align: right;">20629</td>
<td style="text-align: right;">18348</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.00083</td>
<td style="text-align: right;">0.00060</td>
</tr>
<tr class="even">
<td class="rowLabel" style="text-align: left; font-weight: bold;">ξ</td>
<td style="text-align: right;">0.1985</td>
<td style="text-align: right;">0.0517</td>
<td style="text-align: left;">0.117 .. 0.284</td>
<td style="text-align: right;">19706</td>
<td style="text-align: right;">20939</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.00036</td>
<td style="text-align: right;">0.00028</td>
</tr>
<tr class="odd">
<td class="rowLabel" style="text-align: left; font-weight: bold;">log_σ</td>
<td style="text-align: right;">0.138</td>
<td style="text-align: right;">0.0804</td>
<td style="text-align: left;">0.0108 .. 0.267</td>
<td style="text-align: right;">21293</td>
<td style="text-align: right;">18387</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.00059</td>
<td style="text-align: right;">0.00041</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="6a9e5004" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">plot_trace_diagnostics</span>(idata, title_prefix<span class="op">=</span><span class="st">""</span>)  <span class="co">#</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> <span class="fu">Figure</span>(size<span class="op">=</span>(<span class="fl">1200</span>, <span class="fl">400</span>))</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    μ_arr <span class="op">=</span> <span class="fu">Array</span>(idata.posterior.μ)  </span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    log_σ_arr <span class="op">=</span> <span class="fu">Array</span>(idata.posterior.log_σ)  </span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    ξ_arr <span class="op">=</span> <span class="fu">Array</span>(idata.posterior.ξ)  </span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>    ndraws, nchains <span class="op">=</span> <span class="fu">size</span>(μ_arr)  </span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>    ax1 <span class="op">=</span> <span class="fu">Axis</span>(fig[<span class="fl">1</span>, <span class="fl">1</span>], xlabel<span class="op">=</span><span class="st">"Iteration"</span>, ylabel<span class="op">=</span><span class="st">"μ"</span>,</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>        title<span class="op">=</span><span class="st">"</span><span class="sc">$</span>title_prefix<span class="st"> Location Parameter Trace"</span>)</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> c <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span>nchains  </span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>        <span class="fu">lines!</span>(ax1, <span class="fl">1</span><span class="op">:</span>ndraws, μ_arr[<span class="op">:</span>, c], label<span class="op">=</span><span class="st">"Chain </span><span class="sc">$</span>(c)<span class="st">"</span>)  </span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">axislegend</span>(ax1; position<span class="op">=:</span>lb)</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>    ax2 <span class="op">=</span> <span class="fu">Axis</span>(fig[<span class="fl">1</span>, <span class="fl">2</span>], xlabel<span class="op">=</span><span class="st">"Iteration"</span>, ylabel<span class="op">=</span><span class="st">"log(σ)"</span>,</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>        title<span class="op">=</span><span class="st">"</span><span class="sc">$</span>title_prefix<span class="st"> Log-Scale Parameter Trace"</span>)</span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> c <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span>nchains</span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>        <span class="fu">lines!</span>(ax2, <span class="fl">1</span><span class="op">:</span>ndraws, log_σ_arr[<span class="op">:</span>, c])</span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>    ax3 <span class="op">=</span> <span class="fu">Axis</span>(fig[<span class="fl">1</span>, <span class="fl">3</span>], xlabel<span class="op">=</span><span class="st">"Iteration"</span>, ylabel<span class="op">=</span><span class="st">"ξ"</span>,</span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>        title<span class="op">=</span><span class="st">"</span><span class="sc">$</span>title_prefix<span class="st"> Shape Parameter Trace"</span>)</span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> c <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span>nchains</span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a>        <span class="fu">lines!</span>(ax3, <span class="fl">1</span><span class="op">:</span>ndraws, ξ_arr[<span class="op">:</span>, c])</span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> fig</span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a>fig_trace_primary <span class="op">=</span> <span class="fu">plot_trace_diagnostics</span>(posterior_idata, <span class="st">"Primary Station:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<div class="ansi-escaped-output">
<pre><span class="ansi-yellow-fg ansi-bold">┌ </span><span class="ansi-yellow-fg ansi-bold">Warning: </span>Found `resolution` in the theme when creating a `Scene`. The `resolution` keyword for `Scene`s and `Figure`s has been deprecated. Use `Figure(; size = ...` or `Scene(; size = ...)` instead, which better reflects that this is a unitless size and not a pixel resolution. The key could also come from `set_theme!` calls or related theming functions.

<span class="ansi-yellow-fg ansi-bold">└ </span><span class="ansi-bright-black-fg">@ Makie ~/.julia/packages/Makie/4JW9B/src/scenes.jl:264</span>
</pre>
</div>
</div>
<div class="cell-output cell-output-display" data-execution_count="20">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-20-output-2.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p><em>Good distribution between bulk and tail portions and r_hat of 1, model converges</em></p>
<div id="84829048" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> <span class="fu">Figure</span>(size<span class="op">=</span>(<span class="fl">900</span>, <span class="fl">500</span>))</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    rts <span class="op">=</span> <span class="fu">logrange</span>(<span class="fl">1.1</span>, <span class="fl">250</span>, <span class="fl">500</span>)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    ax1 <span class="op">=</span> <span class="fu">Axis</span>(fig[<span class="fl">1</span>, <span class="fl">1</span>], xlabel<span class="op">=</span><span class="st">"Return Period (years)"</span>, ylabel<span class="op">=</span><span class="st">"Return Level (inches)"</span>,</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>        title<span class="op">=</span><span class="st">"Return Level Uncertainty: Prior vs Posterior"</span>, xscale<span class="op">=</span>log10, xticks<span class="op">=</span>[<span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">25</span>, <span class="fl">50</span>, <span class="fl">100</span>, <span class="fl">250</span>])</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">posterior_bands!</span>(ax1, prior_GEVs, rts; color<span class="op">=</span>(<span class="op">:</span>blue, <span class="fl">0.2</span>), ci<span class="op">=</span><span class="fl">0.90</span>, label<span class="op">=</span><span class="st">"Prior 90% CI"</span>)</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">posterior_bands!</span>(ax1, posterior_GEVs, rts; color<span class="op">=</span>(<span class="op">:</span>orange, <span class="fl">0.4</span>), ci<span class="op">=</span><span class="fl">0.90</span>, label<span class="op">=</span><span class="st">"Posterior 90% CI"</span>)</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">posterior_mean_curve!</span>(ax1, posterior_GEVs, rts; color<span class="op">=:</span>blue, linewidth<span class="op">=</span><span class="fl">3</span>, label<span class="op">=</span><span class="st">"Posterior Mean"</span>)</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>    mean_return_levels <span class="op">=</span> [<span class="fu">quantile</span>(mle_dist, <span class="fl">1</span> <span class="op">-</span> <span class="fl">1</span> <span class="op">/</span> T) for T <span class="kw">in</span> rts]</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lines!</span>(ax1, rts, mean_return_levels, color<span class="op">=:</span>red, linewidth<span class="op">=</span><span class="fl">3</span>, label<span class="op">=</span><span class="st">"MLE"</span>)</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">axislegend</span>(ax1; position<span class="op">=:</span>lt)</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>    fig</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<div class="ansi-escaped-output">
<pre><span class="ansi-yellow-fg ansi-bold">┌ </span><span class="ansi-yellow-fg ansi-bold">Warning: </span>Found `resolution` in the theme when creating a `Scene`. The `resolution` keyword for `Scene`s and `Figure`s has been deprecated. Use `Figure(; size = ...` or `Scene(; size = ...)` instead, which better reflects that this is a unitless size and not a pixel resolution. The key could also come from `set_theme!` calls or related theming functions.

<span class="ansi-yellow-fg ansi-bold">└ </span><span class="ansi-bright-black-fg">@ Makie ~/.julia/packages/Makie/4JW9B/src/scenes.jl:264</span>
</pre>
</div>
</div>
<div class="cell-output cell-output-display" data-execution_count="21">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-21-output-2.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="and-100-year-return-estimates" class="level3" data-number="0.7">
<h3 data-number="0.7" class="anchored" data-anchor-id="and-100-year-return-estimates"><span class="header-section-number">0.7</span> 50 and 100-year Return Estimates</h3>
<div id="2ac6d031" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>rl_50 <span class="op">=</span> [<span class="fu">quantile</span>(dist, <span class="fl">1</span> <span class="op">-</span> <span class="fl">1</span><span class="op">/</span><span class="fl">50</span>) for dist <span class="kw">in</span> posterior_GEVs]</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>rl_100 <span class="op">=</span> [<span class="fu">quantile</span>(dist, <span class="fl">1</span> <span class="op">-</span> <span class="fl">1</span><span class="op">/</span><span class="fl">100</span>) for dist <span class="kw">in</span> posterior_GEVs]</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 95% uncertainty bounds</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>rl_50_ci <span class="op">=</span> <span class="fu">quantile</span>(rl_50, [<span class="fl">0.025</span>, <span class="fl">0.975</span>])  </span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>rl_100_ci <span class="op">=</span> <span class="fu">quantile</span>(rl_100, [<span class="fl">0.025</span>, <span class="fl">0.975</span>])</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>fig_return_hists <span class="op">=</span> <span class="kw">let</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> <span class="fu">Figure</span>(size<span class="op">=</span>(<span class="fl">1000</span>, <span class="fl">400</span>))</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Histogram for 50-year return level</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>    ax1 <span class="op">=</span> <span class="fu">Axis</span>(fig[<span class="fl">1</span>, <span class="fl">1</span>], xlabel<span class="op">=</span><span class="st">"50-Year Return Level (inches)"</span>, ylabel<span class="op">=</span><span class="st">"Frequency"</span>,</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>               title<span class="op">=</span><span class="st">"Posterior: 50-Year Return Level"</span>)</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">hist!</span>(ax1, rl_50, bins<span class="op">=</span><span class="fl">30</span>, color<span class="op">=</span>(<span class="op">:</span>blue, <span class="fl">0.6</span>), strokecolor<span class="op">=:</span>black)</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">vlines!</span>(ax1, [rl_50_ci[<span class="fl">1</span>], rl_50_ci[<span class="fl">2</span>]], color<span class="op">=:</span>black, linestyle<span class="op">=:</span>dash)</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Histogram for 100-year return level</span></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>    ax2 <span class="op">=</span> <span class="fu">Axis</span>(fig[<span class="fl">1</span>, <span class="fl">2</span>], xlabel<span class="op">=</span><span class="st">"100-Year Return Level (inches)"</span>, ylabel<span class="op">=</span><span class="st">"Frequency"</span>,</span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>               title<span class="op">=</span><span class="st">"Posterior: 100-Year Return Level"</span>)</span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">hist!</span>(ax2, rl_100, bins<span class="op">=</span><span class="fl">30</span>, color<span class="op">=</span>(<span class="op">:</span>green, <span class="fl">0.6</span>), strokecolor<span class="op">=:</span>black)</span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">vlines!</span>(ax2, [rl_100_ci[<span class="fl">1</span>], rl_50_ci[<span class="fl">2</span>]], color<span class="op">=:</span>black, linestyle<span class="op">=:</span>dash)</span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>    fig</span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<div class="ansi-escaped-output">
<pre><span class="ansi-yellow-fg ansi-bold">┌ </span><span class="ansi-yellow-fg ansi-bold">Warning: </span>Found `resolution` in the theme when creating a `Scene`. The `resolution` keyword for `Scene`s and `Figure`s has been deprecated. Use `Figure(; size = ...` or `Scene(; size = ...)` instead, which better reflects that this is a unitless size and not a pixel resolution. The key could also come from `set_theme!` calls or related theming functions.

<span class="ansi-yellow-fg ansi-bold">└ </span><span class="ansi-bright-black-fg">@ Makie ~/.julia/packages/Makie/4JW9B/src/scenes.jl:264</span>
</pre>
</div>
</div>
<div class="cell-output cell-output-display" data-execution_count="22">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-22-output-2.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="task-2" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="task-2">Task 2</h2>
<section id="multi-station-gev" class="level3" data-number="0.8">
<h3 data-number="0.8" class="anchored" data-anchor-id="multi-station-gev"><span class="header-section-number">0.8</span> Multi-Station GEV</h3>
<div id="4fd72287" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>nearest_stations <span class="op">=</span> <span class="fu">find_nearest_stations</span>(austin_station, stations, <span class="fl">5</span>)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>nearest_stnids <span class="op">=</span> [<span class="fl">789</span>, <span class="fl">10</span>, <span class="fl">787</span>, <span class="fl">752</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<pre><code>4-element Vector{Int64}:
 789
  10
 787
 752</code></pre>
</div>
</div>
<p><em>going to use the same priors as I did for the Austin station, assuming the stations are similar in geographical properties to Austin considering they are close by</em></p>
<div id="e3c8b3b4" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">Turing_MLE_Params</span>(stnid, stations, rainfall_data)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Dictionary to hold a DataFrame of GEV parameters for each station</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    results <span class="op">=</span> <span class="fu">Dict</span>()</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> stn_id <span class="kw">in</span> stnid</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>         <span class="co">#1. Filter station row</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>        station_row <span class="op">=</span> <span class="fu">filter</span>(row <span class="op">-&gt;</span> row.stnid <span class="op">==</span> stn_id, stations)</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>        station_row <span class="op">=</span> <span class="fu">first</span>(station_row, <span class="fl">1</span>)  <span class="co"># assuming only one row per stnid</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>        <span class="co">#2. Filter rainfall data for this station and sort by date</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>        station_data <span class="op">=</span> <span class="fu">filter</span>(row <span class="op">-&gt;</span> row.stnid <span class="op">==</span> stn_id, rainfall_data)</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>        <span class="fu">sort!</span>(station_data, <span class="op">:</span>date)</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 3. Preprocess rainfall values</span></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>        precip <span class="op">=</span> <span class="fu">collect</span>(<span class="fu">skipmissing</span>(<span class="fu">ustrip</span>.(u<span class="st">"inch"</span>, station_data.rainfall)))</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 4. Define and fit the model</span></span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@model</span> <span class="kw">function</span> <span class="fu">gev_model</span>(precip)</span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>            μ <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">2</span>, <span class="fl">1</span>)</span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>            log_σ <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">1.0</span>, <span class="fl">0.5</span>)</span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>            ξ <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0.1</span>, <span class="fl">0.1</span>)</span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>            σ <span class="op">=</span> <span class="fu">exp</span>(log_σ)</span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a>            precip <span class="op">.~</span> <span class="fu">GeneralizedExtremeValue</span>(μ, σ, ξ)</span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a>        mle_result <span class="op">=</span> <span class="fu">maximum_likelihood</span>(</span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a>            <span class="fu">gev_model</span>(precip), </span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a>            <span class="fu">NelderMead</span>(); </span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a>            initial_params <span class="op">=</span> [<span class="fl">2.0</span>, <span class="fl">0.5</span>, <span class="fl">0.1</span>]</span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-32"><a href="#cb33-32" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 5. Extract and store parameters</span></span>
<span id="cb33-33"><a href="#cb33-33" aria-hidden="true" tabindex="-1"></a>        μ_t <span class="op">=</span> mle_result.values[<span class="op">:</span>μ]</span>
<span id="cb33-34"><a href="#cb33-34" aria-hidden="true" tabindex="-1"></a>        σ_t <span class="op">=</span> <span class="fu">exp</span>(mle_result.values[<span class="op">:</span>log_σ])</span>
<span id="cb33-35"><a href="#cb33-35" aria-hidden="true" tabindex="-1"></a>        ξ_t <span class="op">=</span> mle_result.values[<span class="op">:</span>ξ]</span>
<span id="cb33-36"><a href="#cb33-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-37"><a href="#cb33-37" aria-hidden="true" tabindex="-1"></a>        param_df <span class="op">=</span> <span class="fu">DataFrame</span>(</span>
<span id="cb33-38"><a href="#cb33-38" aria-hidden="true" tabindex="-1"></a>            Parameter <span class="op">=</span> [<span class="st">"Location (μ)"</span>, <span class="st">"Scale (σ)"</span>, <span class="st">"Shape (ξ)"</span>],</span>
<span id="cb33-39"><a href="#cb33-39" aria-hidden="true" tabindex="-1"></a>            Value <span class="op">=</span> [μ_t, σ_t, ξ_t],</span>
<span id="cb33-40"><a href="#cb33-40" aria-hidden="true" tabindex="-1"></a>            Rounded <span class="op">=</span> <span class="fu">round</span>.([μ_t, σ_t, ξ_t]; digits<span class="op">=</span><span class="fl">3</span>),</span>
<span id="cb33-41"><a href="#cb33-41" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb33-42"><a href="#cb33-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-43"><a href="#cb33-43" aria-hidden="true" tabindex="-1"></a>        results[stn_id] <span class="op">=</span> param_df</span>
<span id="cb33-44"><a href="#cb33-44" aria-hidden="true" tabindex="-1"></a>    <span class="kw">end</span></span>
<span id="cb33-45"><a href="#cb33-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-46"><a href="#cb33-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> results</span>
<span id="cb33-47"><a href="#cb33-47" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<pre><code>Turing_MLE_Params (generic function with 1 method)</code></pre>
</div>
</div>
<div id="b046b8a1" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>Combined_results <span class="op">=</span> <span class="fu">Turing_MLE_Params</span>(nearest_stnids, stations, rainfall_data)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (stn_id, df) <span class="kw">in</span> Combined_results</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">println</span>(<span class="st">"Results for station ID: </span><span class="sc">$</span>stn_id<span class="st">"</span>)</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">display</span>(df)</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">println</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span> <span class="op">*</span> <span class="st">"#"</span><span class="op">^</span><span class="fl">40</span> <span class="op">*</span> <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)  <span class="co">#looked up a seperator to make Turing GEV results easier to view</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Results for station ID: 789</code></pre>
</div>
<div class="cell-output cell-output-display">
<div><div style="float: left;"><span>3×3 DataFrame</span></div><div style="clear: both;"></div></div><div class="data-frame" style="overflow-x: scroll;">
<table class="data-frame caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th class="rowNumber" data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;">Row</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Parameter</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Value</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Rounded</th>
</tr>
<tr class="subheader headerLastRow even">
<th class="rowNumber" data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="String">String</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Float64">Float64</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Float64">Float64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">1</td>
<td style="text-align: left;">Location (μ)</td>
<td style="text-align: right;">2.78042</td>
<td style="text-align: right;">2.78</td>
</tr>
<tr class="even">
<td class="rowNumber" style="text-align: right; font-weight: bold;">2</td>
<td style="text-align: left;">Scale (σ)</td>
<td style="text-align: right;">1.03774</td>
<td style="text-align: right;">1.038</td>
</tr>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">3</td>
<td style="text-align: left;">Shape (ξ)</td>
<td style="text-align: right;">0.036371</td>
<td style="text-align: right;">0.036</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
########################################

Results for station ID: 10</code></pre>
</div>
<div class="cell-output cell-output-display">
<div><div style="float: left;"><span>3×3 DataFrame</span></div><div style="clear: both;"></div></div><div class="data-frame" style="overflow-x: scroll;">
<table class="data-frame caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th class="rowNumber" data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;">Row</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Parameter</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Value</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Rounded</th>
</tr>
<tr class="subheader headerLastRow even">
<th class="rowNumber" data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="String">String</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Float64">Float64</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Float64">Float64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">1</td>
<td style="text-align: left;">Location (μ)</td>
<td style="text-align: right;">2.64212</td>
<td style="text-align: right;">2.642</td>
</tr>
<tr class="even">
<td class="rowNumber" style="text-align: right; font-weight: bold;">2</td>
<td style="text-align: left;">Scale (σ)</td>
<td style="text-align: right;">1.20567</td>
<td style="text-align: right;">1.206</td>
</tr>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">3</td>
<td style="text-align: left;">Shape (ξ)</td>
<td style="text-align: right;">0.571164</td>
<td style="text-align: right;">0.571</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
########################################

Results for station ID: 752</code></pre>
</div>
<div class="cell-output cell-output-display">
<div><div style="float: left;"><span>3×3 DataFrame</span></div><div style="clear: both;"></div></div><div class="data-frame" style="overflow-x: scroll;">
<table class="data-frame caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th class="rowNumber" data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;">Row</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Parameter</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Value</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Rounded</th>
</tr>
<tr class="subheader headerLastRow even">
<th class="rowNumber" data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="String">String</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Float64">Float64</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Float64">Float64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">1</td>
<td style="text-align: left;">Location (μ)</td>
<td style="text-align: right;">2.72076</td>
<td style="text-align: right;">2.721</td>
</tr>
<tr class="even">
<td class="rowNumber" style="text-align: right; font-weight: bold;">2</td>
<td style="text-align: left;">Scale (σ)</td>
<td style="text-align: right;">1.01854</td>
<td style="text-align: right;">1.019</td>
</tr>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">3</td>
<td style="text-align: left;">Shape (ξ)</td>
<td style="text-align: right;">0.10854</td>
<td style="text-align: right;">0.109</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
########################################

Results for station ID: 787</code></pre>
</div>
<div class="cell-output cell-output-display">
<div><div style="float: left;"><span>3×3 DataFrame</span></div><div style="clear: both;"></div></div><div class="data-frame" style="overflow-x: scroll;">
<table class="data-frame caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th class="rowNumber" data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;">Row</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Parameter</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Value</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Rounded</th>
</tr>
<tr class="subheader headerLastRow even">
<th class="rowNumber" data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="String">String</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Float64">Float64</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Float64">Float64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">1</td>
<td style="text-align: left;">Location (μ)</td>
<td style="text-align: right;">2.88822</td>
<td style="text-align: right;">2.888</td>
</tr>
<tr class="even">
<td class="rowNumber" style="text-align: right; font-weight: bold;">2</td>
<td style="text-align: left;">Scale (σ)</td>
<td style="text-align: right;">1.3334</td>
<td style="text-align: right;">1.333</td>
</tr>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">3</td>
<td style="text-align: left;">Shape (ξ)</td>
<td style="text-align: right;">0.241787</td>
<td style="text-align: right;">0.242</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
########################################
</code></pre>
</div>
</div>
<p><em>Results from each station are similar but not the exact same as eachother or the Austin Station</em></p>
</section>
<section id="multi-station-50-year-return-level-estimate-comparison" class="level3" data-number="0.9">
<h3 data-number="0.9" class="anchored" data-anchor-id="multi-station-50-year-return-level-estimate-comparison"><span class="header-section-number">0.9</span> Multi-Station 50-year Return Level Estimate Comparison</h3>
<div id="8e6ea126" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">return_level_gev</span>(μ, σ, ξ, T)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>    return_lvl <span class="op">=</span> [<span class="fu">round</span>(<span class="fu">quantile</span>(extremes_dist, <span class="fl">1</span> <span class="op">-</span> <span class="fl">1</span> <span class="op">/</span> T), digits <span class="op">=</span> <span class="fl">2</span>)]</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">
<pre><code>return_level_gev (generic function with 1 method)</code></pre>
</div>
</div>
<div id="f37eb5c5" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>return_period <span class="op">=</span> <span class="fl">50</span> </span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>return_level_summary <span class="op">=</span> <span class="fu">DataFrame</span>(Station_ID <span class="op">=</span> <span class="dt">Int</span>[], Return_Level <span class="op">=</span> <span class="dt">Float64</span>[])</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (stn_id, df) <span class="kw">in</span> Combined_results</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>    μ <span class="op">=</span> df[df.Parameter <span class="op">.==</span> <span class="st">"Location (μ)"</span>, <span class="op">:</span>Value][<span class="fl">1</span>]</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>    σ <span class="op">=</span> df[df.Parameter <span class="op">.==</span> <span class="st">"Scale (σ)"</span>, <span class="op">:</span>Value][<span class="fl">1</span>]</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>    ξ <span class="op">=</span> df[df.Parameter <span class="op">.==</span> <span class="st">"Shape (ξ)"</span>, <span class="op">:</span>Value][<span class="fl">1</span>]</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compute return level</span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>    rl <span class="op">=</span> <span class="fu">return_level_gev</span>(μ, σ, ξ, return_period)</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Store the result</span></span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">push!</span>(return_level_summary, (</span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>    Station_ID <span class="op">=</span> stn_id,</span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>    Return_Level <span class="op">=</span> <span class="fu">round</span>(<span class="fu">return_level_gev</span>(μ, σ, ξ, return_period)[<span class="fl">1</span>]; digits<span class="op">=</span><span class="fl">3</span>)</span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the summary table</span></span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a><span class="fu">println</span>(<span class="st">"Return Level Summary for </span><span class="sc">$</span>return_period<span class="st">-Year Period:"</span>)</span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a><span class="fu">display</span>(return_level_summary)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Return Level Summary for 50-Year Period:</code></pre>
</div>
<div class="cell-output cell-output-display">
<div><div style="float: left;"><span>4×2 DataFrame</span></div><div style="clear: both;"></div></div><div class="data-frame" style="overflow-x: scroll;">
<table class="data-frame caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th class="rowNumber" data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;">Row</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Station_ID</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Return_Level</th>
</tr>
<tr class="subheader headerLastRow even">
<th class="rowNumber" data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Int64">Int64</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Float64">Float64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">1</td>
<td style="text-align: right;">789</td>
<td style="text-align: right;">10.99</td>
</tr>
<tr class="even">
<td class="rowNumber" style="text-align: right; font-weight: bold;">2</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">10.99</td>
</tr>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">3</td>
<td style="text-align: right;">752</td>
<td style="text-align: right;">10.99</td>
</tr>
<tr class="even">
<td class="rowNumber" style="text-align: right; font-weight: bold;">4</td>
<td style="text-align: right;">787</td>
<td style="text-align: right;">10.99</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="time-series-of-all-5-stations" class="level3" data-number="0.10">
<h3 data-number="0.10" class="anchored" data-anchor-id="time-series-of-all-5-stations"><span class="header-section-number">0.10</span> Time Series of All 5 Stations</h3>
<div id="981cb5c2" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>all_stnid <span class="op">=</span> [<span class="fl">112</span>, <span class="fl">10</span>, <span class="fl">787</span>, <span class="fl">752</span>, <span class="fl">468</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="28">
<pre><code>5-element Vector{Int64}:
 112
  10
 787
 752
 468</code></pre>
</div>
</div>
<div id="3229805e" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">plot_nearby_comparison</span>(stations_df, rainfall_data, stnid)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> <span class="fu">Figure</span>(size <span class="op">=</span> (<span class="fl">800</span>, <span class="fl">400</span>))</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>    ax <span class="op">=</span> <span class="fu">Axis</span>(fig[<span class="fl">1</span>, <span class="fl">1</span>],</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>        ylabel <span class="op">=</span> <span class="st">"Annual Maximum Rainfall [inch]"</span>,</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>        title <span class="op">=</span> <span class="st">"Comparison of Austin and 4 Nearby Stations"</span>,</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>        dim2_conversion <span class="op">=</span> rainfall_conversion)</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>    colors <span class="op">=</span> [<span class="fu">get</span>(colorschemes[<span class="op">:</span>viridis], i <span class="op">/</span> <span class="fu">length</span>(stnid)) for i <span class="kw">in</span> <span class="fl">0</span><span class="op">:</span><span class="fu">length</span>(stnid)<span class="op">-</span><span class="fl">1</span>]</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i, stnid) <span class="kw">in</span> <span class="fu">enumerate</span>(stnid)</span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>        station_data <span class="op">=</span> <span class="fu">filter</span>(row <span class="op">-&gt;</span> row.stnid <span class="op">==</span> stnid, rainfall_data)</span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>        <span class="fu">sort!</span>(station_data, <span class="op">:</span>date)</span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>        station_row <span class="op">=</span> <span class="fu">filter</span>(row <span class="op">-&gt;</span> row.stnid <span class="op">==</span> stnid, stations_df)</span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a>        station_row <span class="op">=</span> <span class="fu">first</span>(station_row)</span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a>        <span class="fu">lines!</span>(ax, station_data.date, station_data.rainfall,</span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a>               color <span class="op">=</span> colors[i], linewidth <span class="op">=</span> <span class="fl">2</span>,</span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a>               label <span class="op">=</span> <span class="st">"</span><span class="sc">$</span>(station_row.noaa_id)<span class="st">: </span><span class="sc">$</span>(station_row.name)<span class="st">"</span>)</span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scatter!</span>(ax, station_data.date, station_data.rainfall,</span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a>                 color <span class="op">=</span> colors[i], markersize <span class="op">=</span> <span class="fl">8</span>)</span>
<span id="cb47-23"><a href="#cb47-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb47-24"><a href="#cb47-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-25"><a href="#cb47-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">axislegend</span>(ax, position <span class="op">=</span> <span class="op">:</span>lt, fontsize <span class="op">=</span> <span class="fl">4</span>, patchsize <span class="op">=</span> (<span class="fl">4</span>, <span class="fl">4</span>))</span>
<span id="cb47-26"><a href="#cb47-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> fig</span>
<span id="cb47-27"><a href="#cb47-27" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">
<pre><code>plot_nearby_comparison (generic function with 1 method)</code></pre>
</div>
</div>
<div id="527cf806" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_nearby_comparison</span>(stations, rainfall_data, all_stnid)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<div class="ansi-escaped-output">
<pre><span class="ansi-yellow-fg ansi-bold">┌ </span><span class="ansi-yellow-fg ansi-bold">Warning: </span>Found `resolution` in the theme when creating a `Scene`. The `resolution` keyword for `Scene`s and `Figure`s has been deprecated. Use `Figure(; size = ...` or `Scene(; size = ...)` instead, which better reflects that this is a unitless size and not a pixel resolution. The key could also come from `set_theme!` calls or related theming functions.

<span class="ansi-yellow-fg ansi-bold">└ </span><span class="ansi-bright-black-fg">@ Makie ~/.julia/packages/Makie/4JW9B/src/scenes.jl:264</span>
</pre>
</div>
</div>
<div class="cell-output cell-output-display" data-execution_count="30">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-30-output-2.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="task-3" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="task-3">Task 3</h2>
<div id="4eba4798" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LinearAlgebra</span>: I</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LaTeXStrings</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="mann-kendall-on-austin-station" class="level3" data-number="0.11">
<h3 data-number="0.11" class="anchored" data-anchor-id="mann-kendall-on-austin-station"><span class="header-section-number">0.11</span> Mann Kendall on Austin Station</h3>
<div id="90844a89" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">mann_kendall_test</span>(x<span class="op">::</span><span class="dt">AbstractVector</span>)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>    n <span class="op">=</span> <span class="fu">length</span>(x)</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>    S <span class="op">=</span> <span class="fu">sum</span>(<span class="fu">sign</span>(x[j] <span class="op">-</span> x[i]) <span class="cf">for</span> i <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span>(n<span class="op">-</span><span class="fl">1</span>) <span class="cf">for</span> j <span class="kw">in</span> (i<span class="op">+</span><span class="fl">1</span>)<span class="op">:</span>n)</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>    var_S <span class="op">=</span> n <span class="op">*</span> (n <span class="op">-</span> <span class="fl">1</span>) <span class="op">*</span> (<span class="fl">2</span>n <span class="op">+</span> <span class="fl">5</span>) <span class="op">/</span> <span class="fl">18</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>    Z <span class="op">=</span> <span class="cf">if</span> S <span class="op">&gt;</span> <span class="fl">0</span></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>        (S <span class="op">-</span> <span class="fl">1</span>) <span class="op">/</span> <span class="fu">sqrt</span>(var_S)</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elseif</span> S <span class="op">&lt;</span> <span class="fl">0</span></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>        (S <span class="op">+</span> <span class="fl">1</span>) <span class="op">/</span> <span class="fu">sqrt</span>(var_S)</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>        <span class="fl">0.0</span></span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a>    p_value <span class="op">=</span> <span class="fl">2</span> <span class="op">*</span> (<span class="fl">1</span> <span class="op">-</span> <span class="fu">cdf</span>(<span class="fu">Normal</span>(<span class="fl">0</span>, <span class="fl">1</span>), <span class="fu">abs</span>(Z)))</span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> S, p_value</span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="32">
<pre><code>mann_kendall_test (generic function with 1 method)</code></pre>
</div>
</div>
<div id="95bd0413" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>mk_S, mk_p <span class="op">=</span> <span class="fu">mann_kendall_test</span>(precip) <span class="co">#Using austin precip that was defined earlier</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="fu">show</span>(mk_S)</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="fu">show</span>(mk_p)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>-643.00.18091837915390796</code></pre>
</div>
</div>
<p><em>Our Mann-Kendall Test Statistic is -693 which is quite a large number and would indicate a decreasing trend, but our p-value being so large (0.18) makes the prediction statistically insignificant (significant pvalue &lt; 0.05)</em></p>
<div id="a6e6df8e" class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get 4 nearest stations that are NOT Austin</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>nearest_stations <span class="op">=</span> <span class="pp">@chain</span> stations <span class="cf">begin</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(row <span class="op">-&gt;</span> row.stnid <span class="op">!=</span> austin_station.stnid, _)</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">find_nearest_stations</span>(austin_station, _, <span class="fl">4</span>)</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Get Austin station row</span></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>austin_row <span class="op">=</span> <span class="fu">filter</span>(row <span class="op">-&gt;</span> row.stnid <span class="op">==</span> austin_station.stnid, stations)</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>austin_row <span class="op">=</span> <span class="fu">first</span>(austin_row, <span class="fl">1</span>)</span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine Austin with 4 nearby stations </span></span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>MK_stations <span class="op">=</span> <span class="fu">vcat</span>(austin_row, nearest_stations)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="34">
<div><div style="float: left;"><span>5×7 DataFrame</span></div><div style="clear: both;"></div></div><div class="data-frame" style="overflow-x: scroll;">
<table class="data-frame caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th class="rowNumber" data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;">Row</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">stnid</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">noaa_id</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">name</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">state</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">latitude</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">longitude</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">years_of_data</th>
</tr>
<tr class="subheader headerLastRow even">
<th class="rowNumber" data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Int64">Int64</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="String">String</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="String">String</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="String">String</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Float64">Float64</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Float64">Float64</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Int64">Int64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">1</td>
<td style="text-align: right;">112</td>
<td style="text-align: left;">41-0420</td>
<td style="text-align: left;">AUSTIN</td>
<td style="text-align: left;">TX</td>
<td style="text-align: right;">30.2682</td>
<td style="text-align: right;">-97.7426</td>
<td style="text-align: right;">169</td>
</tr>
<tr class="even">
<td class="rowNumber" style="text-align: right; font-weight: bold;">2</td>
<td style="text-align: right;">789</td>
<td style="text-align: left;">79-0086</td>
<td style="text-align: left;">AUSTIN-CAMP MABRY</td>
<td style="text-align: left;">TX</td>
<td style="text-align: right;">30.3208</td>
<td style="text-align: right;">-97.7603</td>
<td style="text-align: right;">79</td>
</tr>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">3</td>
<td style="text-align: right;">10</td>
<td style="text-align: left;">63-0192</td>
<td style="text-align: left;">BARTON CRK AT LOOP 360, AUSTIN</td>
<td style="text-align: left;">TX</td>
<td style="text-align: right;">30.2442</td>
<td style="text-align: right;">-97.8021</td>
<td style="text-align: right;">31</td>
</tr>
<tr class="even">
<td class="rowNumber" style="text-align: right; font-weight: bold;">4</td>
<td style="text-align: right;">787</td>
<td style="text-align: left;">79-0073</td>
<td style="text-align: left;">AUSTIN BERGSTROM AP</td>
<td style="text-align: left;">TX</td>
<td style="text-align: right;">30.1831</td>
<td style="text-align: right;">-97.68</td>
<td style="text-align: right;">101</td>
</tr>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">5</td>
<td style="text-align: right;">752</td>
<td style="text-align: left;">65-0100</td>
<td style="text-align: left;">DECKER POWER PLANT</td>
<td style="text-align: left;">TX</td>
<td style="text-align: right;">30.3036</td>
<td style="text-align: right;">-97.6143</td>
<td style="text-align: right;">31</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="mk-on-multiple-stations" class="level3" data-number="0.12">
<h3 data-number="0.12" class="anchored" data-anchor-id="mk-on-multiple-stations"><span class="header-section-number">0.12</span> MK on Multiple Stations</h3>
<div id="503bfafe" class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>    stnids <span class="op">=</span> MK_stations.stnid</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>    raw_results <span class="op">=</span> <span class="fu">map</span>(stnids) <span class="cf">do</span> stnid</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> <span class="pp">@chain</span> rainfall_data <span class="cf">begin</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>            <span class="pp">@filter</span>(stnid <span class="op">==</span> !!stnid)</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>            <span class="pp">@filter</span>(!<span class="fu">ismissing</span>(rainfall))</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>        prcp <span class="op">=</span> <span class="fu">ustrip</span>.(u<span class="st">"inch"</span>, df.rainfall)</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>        mk_S, mk_p <span class="op">=</span> <span class="fu">mann_kendall_test</span>(prcp)</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> mk_S, mk_p</span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>    MK_stations[!, <span class="op">:</span>mk_S] <span class="op">=</span> <span class="fu">getindex</span>.(raw_results, <span class="fl">1</span>)</span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>    MK_stations[!, <span class="op">:</span>mk_pvalue] <span class="op">=</span> <span class="fu">getindex</span>.(raw_results, <span class="fl">2</span>)</span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a><span class="fu">show</span>(MK_stations)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<div class="ansi-escaped-output">
<pre><span class="ansi-bold">5×9 DataFrame</span>

<span class="ansi-bold"> Row </span>│<span class="ansi-bold"> stnid </span><span class="ansi-bold"> noaa_id </span><span class="ansi-bold"> name                           </span><span class="ansi-bold"> state  </span><span class="ansi-bold"> latitude </span><span class="ansi-bold"> longi</span> ⋯

     │<span class="ansi-bright-black-fg"> Int64 </span><span class="ansi-bright-black-fg"> String  </span><span class="ansi-bright-black-fg"> String                         </span><span class="ansi-bright-black-fg"> String </span><span class="ansi-bright-black-fg"> Float64  </span><span class="ansi-bright-black-fg"> Float</span> ⋯

─────┼──────────────────────────────────────────────────────────────────────────

   1 │   112  41-0420  AUSTIN                          TX       30.2682   -97. ⋯

   2 │   789  79-0086  AUSTIN-CAMP MABRY               TX       30.3208   -97.

   3 │    10  63-0192  BARTON CRK AT LOOP 360, AUSTIN  TX       30.2442   -97.

   4 │   787  79-0073  AUSTIN BERGSTROM AP             TX       30.1831   -97.

   5 │   752  65-0100  DECKER POWER PLANT              TX       30.3036   -97. ⋯

<span class="ansi-cyan-fg">                                                               4 columns omitted</span></pre>
</div>
</div>
</div>
<p><em>Interestingly enough the S statistic for all the stations are far different from the Austin station despite being geographically close. This could be due to amount of data and the only statistically significant test was from station 787 Astin Bergstrom AP</em></p>
</section>
<section id="fit-at-least-two-nonstationary-gev" class="level3" data-number="0.13">
<h3 data-number="0.13" class="anchored" data-anchor-id="fit-at-least-two-nonstationary-gev"><span class="header-section-number">0.13</span> Fit at least two nonstationary GEV</h3>
<p><em>The covariate I chose was annual mean temperature as a hotter atmosphere can lead to more accumilation of moisture. Data was recieved from https://www.weather.gov/wrh/climate?wfo=ewx and was passed through excel before it was exported as a csv</em></p>
<div id="77941189" class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>temp_data <span class="op">=</span> <span class="kw">let</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>    temp_fname <span class="op">=</span> <span class="fu">joinpath</span>(lab_dir, <span class="st">"Austin_annualTemp.csv"</span>)</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>    TidierFiles.<span class="fu">read_csv</span>(temp_fname) <span class="op">|&gt;</span> DataFrame</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="36">
<div><div style="float: left;"><span>129×2 DataFrame</span></div><div style="float: right;"><span style="font-style: italic;">124 rows omitted</span></div><div style="clear: both;"></div></div><div class="data-frame" style="overflow-x: scroll;">
<table class="data-frame caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th class="rowNumber" data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;">Row</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">year</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">temp</th>
</tr>
<tr class="subheader headerLastRow even">
<th class="rowNumber" data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Int64">Int64</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Float64">Float64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">1</td>
<td style="text-align: right;">1897</td>
<td style="text-align: right;">66.1</td>
</tr>
<tr class="even">
<td class="rowNumber" style="text-align: right; font-weight: bold;">2</td>
<td style="text-align: right;">1898</td>
<td style="text-align: right;">66.6</td>
</tr>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">3</td>
<td style="text-align: right;">1899</td>
<td style="text-align: right;">65.8</td>
</tr>
<tr class="even">
<td style="text-align: right;">⋮</td>
<td style="text-align: right;">⋮</td>
<td style="text-align: right;">⋮</td>
</tr>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">128</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">72.7</td>
</tr>
<tr class="even">
<td class="rowNumber" style="text-align: right; font-weight: bold;">129</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">73.5</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p><em>Location Varying, here only the location parameter varies with the mean annual temperature</em></p>
<div id="c33885ba" class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">nonstationary_gev_model1</span>(y, x) <span class="co">#y is rainfall, x is temp </span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Model 1: μ(x) = α_μ + β_μ*x where x = 69.9</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>    α_μ <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">2.0</span>, <span class="fl">1.0</span>)    <span class="co"># baseline location parameter</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>    β_μ <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0.0</span>, <span class="fl">2.0</span>)    <span class="co"># location trend parameter (inches per log(ppm))</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>    log_σ <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">1.0</span>, <span class="fl">0.5</span>)  <span class="co"># log-scale parameter</span></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>    ξ <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0.1</span>, <span class="fl">0.1</span>)      <span class="co"># shape parameter</span></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>    σ <span class="op">=</span> <span class="fu">exp</span>(log_σ)</span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Location parameter varies with temp</span></span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="fu">eachindex</span>(y)</span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a>        x_centered <span class="op">=</span> x[i] <span class="op">-</span> <span class="fl">69.9</span>  <span class="co"># midpoint at 2005 @ 69.9</span></span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a>        μ_x <span class="op">=</span> α_μ <span class="op">+</span> β_μ <span class="op">*</span> x_centered</span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a>        dist <span class="op">=</span> <span class="fu">GeneralizedExtremeValue</span>(μ_x, σ, ξ)</span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a>        y[i] <span class="op">~</span> dist</span>
<span id="cb58-16"><a href="#cb58-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb58-17"><a href="#cb58-17" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="37">
<pre><code>nonstationary_gev_model1 (generic function with 2 methods)</code></pre>
</div>
</div>
<p><em>Location and scale varying model, here both Locationa and Scale parameters vary with the mean annual temperature</em></p>
<div id="9ed9f8ed" class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">nonstationary_gev_model2</span>(y, x)</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Model 2: μ(x) = α_μ + β_μ*x, σ(x) = α_σ + β_σ*x</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>    α_μ <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">2.0</span>, <span class="fl">1.0</span>)      <span class="co"># baseline location parameter</span></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>    β_μ <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0.0</span>, <span class="fl">2.0</span>)      <span class="co"># location trend parameter</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>    α_σ <span class="op">~</span> <span class="fu">LogNormal</span>(<span class="fl">1.0</span>, <span class="fl">0.50</span>)   <span class="co"># baseline scale parameter</span></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>    β_σ <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0.0</span>, <span class="fl">0.2</span>)      <span class="co"># scale trend parameter (small prior)</span></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>    ξ <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0.1</span>, <span class="fl">0.1</span>)        <span class="co"># shape parameter</span></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="fu">eachindex</span>(y)</span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>        x_centered <span class="op">=</span> x[i] <span class="op">-</span> <span class="fl">69.9</span></span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>        μ_x <span class="op">=</span> α_μ <span class="op">+</span> β_μ <span class="op">*</span> x_centered</span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a>        σ_x <span class="op">=</span> α_σ <span class="op">+</span> β_σ <span class="op">*</span> x_centered</span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Ensure positive scale parameter</span></span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> σ_x <span class="op">&gt;</span> <span class="fl">0.1</span></span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a>            dist <span class="op">=</span> <span class="fu">GeneralizedExtremeValue</span>(μ_x, σ_x, ξ)</span>
<span id="cb60-17"><a href="#cb60-17" aria-hidden="true" tabindex="-1"></a>            y[i] <span class="op">~</span> dist</span>
<span id="cb60-18"><a href="#cb60-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span></span>
<span id="cb60-19"><a href="#cb60-19" aria-hidden="true" tabindex="-1"></a>            Turing.<span class="pp">@addlogprob</span>!(<span class="op">-</span><span class="cn">Inf</span>)</span>
<span id="cb60-20"><a href="#cb60-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb60-21"><a href="#cb60-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb60-22"><a href="#cb60-22" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="38">
<pre><code>nonstationary_gev_model2 (generic function with 2 methods)</code></pre>
</div>
</div>
<p><em>Data cleaning</em></p>
<div id="244a9b76" class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>my_rainfall <span class="op">=</span> <span class="pp">@chain</span> austin_precip <span class="cf">begin</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@arrange</span>(date)</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@full_join</span>(temp_data, <span class="st">"year"</span>)  </span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@arrange</span>(year)</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>my_rainfall_nomissing <span class="op">=</span> <span class="pp">@chain</span> my_rainfall <span class="cf">begin</span></span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@filter</span>(!<span class="fu">ismissing</span>(rainfall) <span class="op">&amp;&amp;</span> !<span class="fu">ismissing</span>(temp))</span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="39">
<div><div style="float: left;"><span>92×5 DataFrame</span></div><div style="float: right;"><span style="font-style: italic;">87 rows omitted</span></div><div style="clear: both;"></div></div><div class="data-frame" style="overflow-x: scroll;">
<table class="data-frame caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th class="rowNumber" data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;">Row</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">stnid</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">date</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">year</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">rainfall</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">temp</th>
</tr>
<tr class="subheader headerLastRow even">
<th class="rowNumber" data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Union{Missing, Int64}">Int64?</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Union{Missing, Date}">Date?</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Int64">Int64</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Union{Missing, Quantity{Float64, 𝐋, Unitful.FreeUnits{(inch,), 𝐋, nothing}}}">Quantity…?</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Union{Missing, Float64}">Float64?</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">1</td>
<td style="text-align: right;">112</td>
<td style="text-align: left;">1898-08-08</td>
<td style="text-align: right;">1898</td>
<td style="text-align: right;">2.0 inch</td>
<td style="text-align: right;">66.6</td>
</tr>
<tr class="even">
<td class="rowNumber" style="text-align: right; font-weight: bold;">2</td>
<td style="text-align: right;">112</td>
<td style="text-align: left;">1899-10-26</td>
<td style="text-align: right;">1899</td>
<td style="text-align: right;">3.1 inch</td>
<td style="text-align: right;">65.8</td>
</tr>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">3</td>
<td style="text-align: right;">112</td>
<td style="text-align: left;">1900-04-06</td>
<td style="text-align: right;">1900</td>
<td style="text-align: right;">6.5 inch</td>
<td style="text-align: right;">64.6</td>
</tr>
<tr class="even">
<td style="text-align: right;">⋮</td>
<td style="text-align: right;">⋮</td>
<td style="text-align: right;">⋮</td>
<td style="text-align: right;">⋮</td>
<td style="text-align: right;">⋮</td>
<td style="text-align: right;">⋮</td>
</tr>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">91</td>
<td style="text-align: right;">112</td>
<td style="text-align: left;">2016-08-14</td>
<td style="text-align: right;">2016</td>
<td style="text-align: right;">3.04 inch</td>
<td style="text-align: right;">71.4</td>
</tr>
<tr class="even">
<td class="rowNumber" style="text-align: right; font-weight: bold;">92</td>
<td style="text-align: right;">112</td>
<td style="text-align: left;">2017-08-26</td>
<td style="text-align: right;">2017</td>
<td style="text-align: right;">7.32 inch</td>
<td style="text-align: right;">72.1</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="d81a9a3e" class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>y_obs <span class="op">=</span> <span class="fu">ustrip</span>.(u<span class="st">"inch"</span>, my_rainfall_nomissing.rainfall)</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>x_obs <span class="op">=</span> my_rainfall_nomissing.temp</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the two models</span></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>models <span class="op">=</span> [</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"Location trend"</span>, <span class="fu">nonstationary_gev_model1</span>(y_obs, x_obs)),</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"Location + Scale trends"</span>, <span class="fu">nonstationary_gev_model2</span>(y_obs, x_obs)),</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample from posteriors and check diagnostics</span></span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>posterior_results <span class="op">=</span> []</span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (name, model) <span class="kw">in</span> models</span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a>    fname <span class="op">=</span> <span class="fu">joinpath</span>(lab_dir, <span class="st">"nonstat_</span><span class="sc">$</span>(<span class="fu">replace</span>(name, <span class="st">" "</span> <span class="op">=&gt;</span> <span class="st">"_"</span>))<span class="st">.nc"</span>)</span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a>    overwrite <span class="op">=</span> <span class="cn">false</span></span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a>    idata <span class="op">=</span> <span class="fu">load_or_sample</span>(fname, model; overwrite<span class="op">=</span>overwrite, samples_per_chain<span class="op">=</span><span class="fl">1000</span>)</span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">push!</span>(posterior_results, (name<span class="op">=</span>name, idata<span class="op">=</span>idata))</span>
<span id="cb63-17"><a href="#cb63-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-18"><a href="#cb63-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check diagnostics immediately after fitting</span></span>
<span id="cb63-19"><a href="#cb63-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">println</span>(<span class="st">"=== Diagnostics for </span><span class="sc">$</span>name<span class="st"> ==="</span>)</span>
<span id="cb63-20"><a href="#cb63-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">display</span>(ArviZ.<span class="fu">summarize</span>(idata))</span>
<span id="cb63-21"><a href="#cb63-21" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<div class="ansi-escaped-output">
<pre><span class="ansi-cyan-fg ansi-bold">[ </span><span class="ansi-cyan-fg ansi-bold">Info: </span>Loaded cached prior samples from nonstat_Location_trend.nc
</pre>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>=== Diagnostics for Location trend ===</code></pre>
</div>
<div class="cell-output cell-output-display">
<table class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<caption>SummaryStats</caption>
<thead>
<tr class="header headerLastRow">
<th class="rowLabel" data-quarto-table-cell-role="th" style="text-align: left; font-weight: bold;"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th">mean</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">std</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">eti89</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">ess_tail</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">ess_bulk</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">rhat</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">mcse_mean</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">mcse_std</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td class="rowLabel" style="text-align: left; font-weight: bold;">β_μ</td>
<td style="text-align: right;">-0.076</td>
<td style="text-align: right;">0.084</td>
<td style="text-align: left;">-0.212 .. 0.0577</td>
<td style="text-align: right;">10558</td>
<td style="text-align: right;">12070</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.00077</td>
<td style="text-align: right;">0.00072</td>
</tr>
<tr class="even">
<td class="rowLabel" style="text-align: left; font-weight: bold;">ξ</td>
<td style="text-align: right;">0.227</td>
<td style="text-align: right;">0.063</td>
<td style="text-align: left;">0.130 .. 0.329</td>
<td style="text-align: right;">8980</td>
<td style="text-align: right;">11546</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.00059</td>
<td style="text-align: right;">0.00052</td>
</tr>
<tr class="odd">
<td class="rowLabel" style="text-align: left; font-weight: bold;">α_μ</td>
<td style="text-align: right;">2.754</td>
<td style="text-align: right;">0.165</td>
<td style="text-align: left;">2.49 .. 3.02</td>
<td style="text-align: right;">9811</td>
<td style="text-align: right;">11531</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.0015</td>
<td style="text-align: right;">0.0014</td>
</tr>
<tr class="even">
<td class="rowLabel" style="text-align: left; font-weight: bold;">log_σ</td>
<td style="text-align: right;">0.180</td>
<td style="text-align: right;">0.102</td>
<td style="text-align: left;">0.0196 .. 0.346</td>
<td style="text-align: right;">10978</td>
<td style="text-align: right;">12354</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.00092</td>
<td style="text-align: right;">0.00080</td>
</tr>
</tbody>
</table>
</div>
<div class="cell-output cell-output-stderr">
<div class="ansi-escaped-output">
<pre><span class="ansi-cyan-fg ansi-bold">[ </span><span class="ansi-cyan-fg ansi-bold">Info: </span>Loaded cached prior samples from nonstat_Location_+_Scale_trends.nc
</pre>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>=== Diagnostics for Location + Scale trends ===</code></pre>
</div>
<div class="cell-output cell-output-display">
<table class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<caption>SummaryStats</caption>
<thead>
<tr class="header headerLastRow">
<th class="rowLabel" data-quarto-table-cell-role="th" style="text-align: left; font-weight: bold;"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th">mean</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">std</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">eti89</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">ess_tail</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">ess_bulk</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">rhat</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">mcse_mean</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">mcse_std</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td class="rowLabel" style="text-align: left; font-weight: bold;">β_μ</td>
<td style="text-align: right;">-0.080</td>
<td style="text-align: right;">0.087</td>
<td style="text-align: left;">-0.217 .. 0.0588</td>
<td style="text-align: right;">10388</td>
<td style="text-align: right;">10948</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.00083</td>
<td style="text-align: right;">0.00068</td>
</tr>
<tr class="even">
<td class="rowLabel" style="text-align: left; font-weight: bold;">α_σ</td>
<td style="text-align: right;">1.211</td>
<td style="text-align: right;">0.140</td>
<td style="text-align: left;">1.00 .. 1.45</td>
<td style="text-align: right;">10021</td>
<td style="text-align: right;">10039</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.0014</td>
<td style="text-align: right;">0.0011</td>
</tr>
<tr class="odd">
<td class="rowLabel" style="text-align: left; font-weight: bold;">α_μ</td>
<td style="text-align: right;">2.761</td>
<td style="text-align: right;">0.164</td>
<td style="text-align: left;">2.50 .. 3.03</td>
<td style="text-align: right;">9443</td>
<td style="text-align: right;">9571</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.0017</td>
<td style="text-align: right;">0.0014</td>
</tr>
<tr class="even">
<td class="rowLabel" style="text-align: left; font-weight: bold;">ξ</td>
<td style="text-align: right;">0.227</td>
<td style="text-align: right;">0.063</td>
<td style="text-align: left;">0.130 .. 0.329</td>
<td style="text-align: right;">9597</td>
<td style="text-align: right;">11923</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.00058</td>
<td style="text-align: right;">0.00052</td>
</tr>
<tr class="odd">
<td class="rowLabel" style="text-align: left; font-weight: bold;">β_σ</td>
<td style="text-align: right;">-0.013</td>
<td style="text-align: right;">0.070</td>
<td style="text-align: left;">-0.126 .. 0.0976</td>
<td style="text-align: right;">9865</td>
<td style="text-align: right;">10066</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.00070</td>
<td style="text-align: right;">0.00053</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><em>R Hat of 1 for all and good distribution amougnst bulk and tail indicate models converge</em></p>
</section>
<section id="return-level-plots" class="level3" data-number="0.14">
<h3 data-number="0.14" class="anchored" data-anchor-id="return-level-plots"><span class="header-section-number">0.14</span> Return Level Plots</h3>
<p><em>First we need to extract GEV distributions</em></p>
<div id="c06218f9" class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 1: Location trend only</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">extract_model1_gevs</span>(idata, x)</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>    x_centered <span class="op">=</span> x <span class="op">-</span> <span class="fl">69.9</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>    α_μ <span class="op">=</span> <span class="fu">Array</span>(idata.posterior[<span class="op">:</span>α_μ])</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>    β_μ <span class="op">=</span> <span class="fu">Array</span>(idata.posterior[<span class="op">:</span>β_μ])</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>    σ <span class="op">=</span> <span class="fu">exp</span>.(<span class="fu">Array</span>(idata.posterior[<span class="op">:</span>log_σ]))</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>    ξ <span class="op">=</span> <span class="fu">Array</span>(idata.posterior[<span class="op">:</span>ξ])</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>    μ_x <span class="op">=</span> α_μ <span class="op">.+</span> β_μ <span class="op">.*</span> x_centered</span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">vec</span>(<span class="fu">GeneralizedExtremeValue</span>.(μ_x, σ, ξ))</span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 2: Location + Scale trends</span></span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">extract_model2_gevs</span>(idata, x)</span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a>    x_centered <span class="op">=</span> x <span class="op">-</span> <span class="fl">69.9</span></span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a>    α_μ <span class="op">=</span> <span class="fu">Array</span>(idata.posterior[<span class="op">:</span>α_μ])</span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a>    β_μ <span class="op">=</span> <span class="fu">Array</span>(idata.posterior[<span class="op">:</span>β_μ])</span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a>    α_σ <span class="op">=</span> <span class="fu">Array</span>(idata.posterior[<span class="op">:</span>α_σ])</span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true" tabindex="-1"></a>    β_σ <span class="op">=</span> <span class="fu">Array</span>(idata.posterior[<span class="op">:</span>β_σ])</span>
<span id="cb66-19"><a href="#cb66-19" aria-hidden="true" tabindex="-1"></a>    ξ <span class="op">=</span> <span class="fu">Array</span>(idata.posterior[<span class="op">:</span>ξ])</span>
<span id="cb66-20"><a href="#cb66-20" aria-hidden="true" tabindex="-1"></a>    μ_x <span class="op">=</span> α_μ <span class="op">.+</span> β_μ <span class="op">.*</span> x_centered</span>
<span id="cb66-21"><a href="#cb66-21" aria-hidden="true" tabindex="-1"></a>    σ_x <span class="op">=</span> α_σ <span class="op">.+</span> β_σ <span class="op">.*</span> x_centered</span>
<span id="cb66-22"><a href="#cb66-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter out negative scale parameters</span></span>
<span id="cb66-23"><a href="#cb66-23" aria-hidden="true" tabindex="-1"></a>    valid <span class="op">=</span> σ_x <span class="op">.&gt;</span> <span class="fl">0.1</span></span>
<span id="cb66-24"><a href="#cb66-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">vec</span>(<span class="fu">GeneralizedExtremeValue</span>.(μ_x[valid], σ_x[valid], ξ[valid]))</span>
<span id="cb66-25"><a href="#cb66-25" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="41">
<pre><code>extract_model2_gevs (generic function with 1 method)</code></pre>
</div>
</div>
<p><em>Now lets extract data from 1898 (first occurance with both rainfall and temp data) and 2017 (last occurance with both rainfall and temp data)</em></p>
<div id="f3f65e2b" class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>model1_name, model1_idata <span class="op">=</span> posterior_results[<span class="fl">1</span>].name, posterior_results[<span class="fl">1</span>].idata</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>model2_name, model2_idata <span class="op">=</span> posterior_results[<span class="fl">2</span>].name, posterior_results[<span class="fl">2</span>].idata</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Approximate temp levels (x = 69.9)</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>x_1950 <span class="op">=</span> temp_data.temp[temp_data.year<span class="op">.==</span><span class="fl">1898</span>][<span class="fl">1</span>]   </span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>x_2025 <span class="op">=</span> temp_data.temp[temp_data.year<span class="op">.==</span><span class="fl">2017</span>][<span class="fl">1</span>]  </span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract GEV distributions for both time periods</span></span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>gevs_1950 <span class="op">=</span> [</span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">extract_model1_gevs</span>(model1_idata, x_1950),</span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">extract_model2_gevs</span>(model2_idata, x_1950),</span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a>gevs_2025 <span class="op">=</span> [</span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">extract_model1_gevs</span>(model1_idata, x_2025),</span>
<span id="cb68-16"><a href="#cb68-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">extract_model2_gevs</span>(model2_idata, x_2025),</span>
<span id="cb68-17"><a href="#cb68-17" aria-hidden="true" tabindex="-1"></a>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="42">
<pre><code>2-element Vector{Vector{GeneralizedExtremeValue{Float64}}}:
 [GeneralizedExtremeValue{Float64}(μ=2.9336575750630742, σ=1.190117241243731, ξ=0.16137901971740531), GeneralizedExtremeValue{Float64}(μ=2.867206984484502, σ=1.151751691024271, ξ=0.1577294979668813), GeneralizedExtremeValue{Float64}(μ=2.2864455057486497, σ=1.163179408528239, ξ=0.25176791992470393), GeneralizedExtremeValue{Float64}(μ=2.5195264957096226, σ=1.0403712407100458, ξ=0.17906675576570358), GeneralizedExtremeValue{Float64}(μ=2.7283537926572796, σ=1.1881570390398588, ξ=0.2645873552700098), GeneralizedExtremeValue{Float64}(μ=2.6116511518454986, σ=1.2078961789090241, ξ=0.15814200555863744), GeneralizedExtremeValue{Float64}(μ=2.9886851813728224, σ=1.3567484191823969, ξ=0.11479414299611194), GeneralizedExtremeValue{Float64}(μ=2.7322148632929273, σ=1.1453287187949233, ξ=0.17450048926182957), GeneralizedExtremeValue{Float64}(μ=2.347265546999373, σ=1.2903659564243233, ξ=0.247180617758842), GeneralizedExtremeValue{Float64}(μ=2.374868909781312, σ=1.111161250370228, ξ=0.3284647221327348)  …  GeneralizedExtremeValue{Float64}(μ=3.1023158768662635, σ=1.3463090878099722, ξ=0.21081961078445327), GeneralizedExtremeValue{Float64}(μ=2.5523752864797564, σ=1.120108990086933, ξ=0.15853505052929198), GeneralizedExtremeValue{Float64}(μ=2.9732728987283847, σ=1.2498434550987716, ξ=0.14941194839111177), GeneralizedExtremeValue{Float64}(μ=2.57458716142547, σ=1.1645553500662065, ξ=0.27215334378943784), GeneralizedExtremeValue{Float64}(μ=2.5467567023379045, σ=1.1879444345790202, ξ=0.26711488312097714), GeneralizedExtremeValue{Float64}(μ=2.7852861363296477, σ=1.279644819034156, ξ=0.15334210679816132), GeneralizedExtremeValue{Float64}(μ=2.4954707671065197, σ=1.1064309837600004, ξ=0.2553589387813485), GeneralizedExtremeValue{Float64}(μ=2.6572452421291994, σ=1.2824237831105816, ξ=0.15140207495956395), GeneralizedExtremeValue{Float64}(μ=2.513328755975497, σ=1.1786846172694567, ξ=0.1615331783588953), GeneralizedExtremeValue{Float64}(μ=2.4418245073720266, σ=1.3330964319251435, ξ=0.25364302664103416)]
 [GeneralizedExtremeValue{Float64}(μ=2.2936694558263193, σ=1.0709130195254837, ξ=0.14581849558594945), GeneralizedExtremeValue{Float64}(μ=2.2936694558263193, σ=1.0709130195254837, ξ=0.14581849558594945), GeneralizedExtremeValue{Float64}(μ=1.9805554572785558, σ=0.795751633842575, ξ=0.28196411549296146), GeneralizedExtremeValue{Float64}(μ=2.6912522376638672, σ=1.1451671191568045, ξ=0.13282092879030025), GeneralizedExtremeValue{Float64}(μ=2.841544308991002, σ=1.035305790747541, ξ=0.13861962483850745), GeneralizedExtremeValue{Float64}(μ=2.7423967922563315, σ=1.0450060963673165, ξ=0.120327747715491), GeneralizedExtremeValue{Float64}(μ=2.8647394628417695, σ=0.8691933280162679, ξ=0.20621903854268014), GeneralizedExtremeValue{Float64}(μ=2.826326381560532, σ=0.9255168385541874, ξ=0.23363400220111433), GeneralizedExtremeValue{Float64}(μ=2.011733404437178, σ=1.1939972755177606, ξ=0.19515382166014852), GeneralizedExtremeValue{Float64}(μ=3.4146366059994375, σ=1.5777692849697513, ξ=0.2039115966397399)  …  GeneralizedExtremeValue{Float64}(μ=2.5980212811865915, σ=1.348142111894918, ξ=0.2316684784266205), GeneralizedExtremeValue{Float64}(μ=2.20983806118283, σ=0.6786567066198523, ξ=0.2625470519637337), GeneralizedExtremeValue{Float64}(μ=2.6177294209458215, σ=1.5132700754673, ξ=0.27757898206318066), GeneralizedExtremeValue{Float64}(μ=2.755734949759069, σ=0.9193823805133474, ξ=0.27893938473877655), GeneralizedExtremeValue{Float64}(μ=2.2296758580590677, σ=1.0843998311291871, ξ=0.251732246839139), GeneralizedExtremeValue{Float64}(μ=2.3909089246133726, σ=0.6809530425629309, ξ=0.2051281537767506), GeneralizedExtremeValue{Float64}(μ=2.5348523339297055, σ=0.7325443175045652, ξ=0.323104250729794), GeneralizedExtremeValue{Float64}(μ=2.0919651793000003, σ=1.162756706792756, ξ=0.24892557711736174), GeneralizedExtremeValue{Float64}(μ=2.681511929583765, σ=1.099565631557729, ξ=0.18757341624724239), GeneralizedExtremeValue{Float64}(μ=2.477667630791757, σ=1.3003554493977187, ξ=0.24608844443709543)]</code></pre>
</div>
</div>
<p><em>Now we generate the return level plot</em></p>
<div id="05f5de1f" class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>fig_comprehensive <span class="op">=</span> <span class="kw">let</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> <span class="fu">Figure</span>(size<span class="op">=</span>(<span class="fl">1000</span>, <span class="fl">700</span>))</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>    rts <span class="op">=</span> <span class="fu">logrange</span>(<span class="fl">1.1</span>, <span class="fl">250</span>, <span class="fl">100</span>)</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>    xticks <span class="op">=</span> [<span class="fl">2</span>, <span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">25</span>, <span class="fl">50</span>, <span class="fl">100</span>, <span class="fl">250</span>]</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>    ax1 <span class="op">=</span> <span class="fu">Axis</span>(fig[<span class="fl">1</span>, <span class="fl">1</span>], xlabel<span class="op">=</span><span class="st">"Return Period (years)"</span>, ylabel<span class="op">=</span><span class="st">"Return Level (inches)"</span>,</span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>        title<span class="op">=</span><span class="st">"Location Trend Model"</span>, xscale<span class="op">=</span>log10, xticks<span class="op">=</span>xticks)</span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>    ax2 <span class="op">=</span> <span class="fu">Axis</span>(fig[<span class="fl">1</span>, <span class="fl">2</span>], xlabel<span class="op">=</span><span class="st">"Return Period (years)"</span>, ylabel<span class="op">=</span><span class="st">"Return Level (inches)"</span>,</span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>        title<span class="op">=</span><span class="st">"Location + Scale Trends Model"</span>, xscale<span class="op">=</span>log10, xticks<span class="op">=</span>xticks)</span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Make columns equal width</span></span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colsize!</span>(fig.layout, <span class="fl">1</span>, <span class="fu">Relative</span>(<span class="fl">0.5</span>))</span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colsize!</span>(fig.layout, <span class="fl">2</span>, <span class="fu">Relative</span>(<span class="fl">0.5</span>))</span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true" tabindex="-1"></a>    top_axes <span class="op">=</span> [ax1, ax2]</span>
<span id="cb70-17"><a href="#cb70-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-18"><a href="#cb70-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i, (ax, gevs_50, gevs_25)) <span class="kw">in</span> <span class="fu">enumerate</span>(<span class="fu">zip</span>(top_axes, gevs_1950, gevs_2025))</span>
<span id="cb70-19"><a href="#cb70-19" aria-hidden="true" tabindex="-1"></a>        <span class="fu">posterior_bands!</span>(ax, gevs_50, rts; ci<span class="op">=</span><span class="fl">0.90</span>, color<span class="op">=</span>(<span class="op">:</span>blue, <span class="fl">0.3</span>))</span>
<span id="cb70-20"><a href="#cb70-20" aria-hidden="true" tabindex="-1"></a>        <span class="fu">posterior_mean_curve!</span>(ax, gevs_50, rts; color<span class="op">=:</span>blue, linewidth<span class="op">=</span><span class="fl">2</span>, label<span class="op">=</span><span class="st">"1950"</span>)</span>
<span id="cb70-21"><a href="#cb70-21" aria-hidden="true" tabindex="-1"></a>        <span class="fu">posterior_bands!</span>(ax, gevs_25, rts; ci<span class="op">=</span><span class="fl">0.90</span>, color<span class="op">=</span>(<span class="op">:</span>red, <span class="fl">0.3</span>))</span>
<span id="cb70-22"><a href="#cb70-22" aria-hidden="true" tabindex="-1"></a>        <span class="fu">posterior_mean_curve!</span>(ax, gevs_25, rts; color<span class="op">=:</span>red, linewidth<span class="op">=</span><span class="fl">2</span>, label<span class="op">=</span><span class="st">"2025"</span>)</span>
<span id="cb70-23"><a href="#cb70-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> i <span class="op">==</span> <span class="fl">1</span></span>
<span id="cb70-24"><a href="#cb70-24" aria-hidden="true" tabindex="-1"></a>            <span class="fu">axislegend</span>(ax, position<span class="op">=:</span>rb)</span>
<span id="cb70-25"><a href="#cb70-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb70-26"><a href="#cb70-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb70-27"><a href="#cb70-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-28"><a href="#cb70-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb70-29"><a href="#cb70-29" aria-hidden="true" tabindex="-1"></a>    ax3 <span class="op">=</span> <span class="fu">Axis</span>(fig[<span class="fl">2</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span>], xlabel<span class="op">=</span><span class="st">"Return Period (years)"</span>, ylabel<span class="op">=</span><span class="st">"Return Level (inches)"</span>,</span>
<span id="cb70-30"><a href="#cb70-30" aria-hidden="true" tabindex="-1"></a>        title<span class="op">=</span><span class="st">"Model Comparison for 2017"</span>,</span>
<span id="cb70-31"><a href="#cb70-31" aria-hidden="true" tabindex="-1"></a>        xscale<span class="op">=</span>log10, xticks<span class="op">=</span>xticks)</span>
<span id="cb70-32"><a href="#cb70-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-33"><a href="#cb70-33" aria-hidden="true" tabindex="-1"></a>    colors <span class="op">=</span> [<span class="op">:</span>blue, <span class="op">:</span>red]</span>
<span id="cb70-34"><a href="#cb70-34" aria-hidden="true" tabindex="-1"></a>    labels <span class="op">=</span> [<span class="st">"Location Trend"</span>, <span class="st">"Location + Scale"</span>]</span>
<span id="cb70-35"><a href="#cb70-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-36"><a href="#cb70-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i, (gevs, color, label)) <span class="kw">in</span> <span class="fu">enumerate</span>(<span class="fu">zip</span>(gevs_2025, colors, labels))</span>
<span id="cb70-37"><a href="#cb70-37" aria-hidden="true" tabindex="-1"></a>        <span class="fu">posterior_bands!</span>(ax3, gevs, rts; ci<span class="op">=</span><span class="fl">0.68</span>, color<span class="op">=</span>(color, <span class="fl">0.3</span>))</span>
<span id="cb70-38"><a href="#cb70-38" aria-hidden="true" tabindex="-1"></a>        <span class="fu">posterior_mean_curve!</span>(ax3, gevs, rts; color<span class="op">=</span>color, linewidth<span class="op">=</span><span class="fl">2</span>, label<span class="op">=</span>label)</span>
<span id="cb70-39"><a href="#cb70-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb70-40"><a href="#cb70-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-41"><a href="#cb70-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">axislegend</span>(ax3, position<span class="op">=:</span>lt)</span>
<span id="cb70-42"><a href="#cb70-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">linkyaxes!</span>(top_axes<span class="op">...</span>)</span>
<span id="cb70-43"><a href="#cb70-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-44"><a href="#cb70-44" aria-hidden="true" tabindex="-1"></a>    fig</span>
<span id="cb70-45"><a href="#cb70-45" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<div class="ansi-escaped-output">
<pre><span class="ansi-yellow-fg ansi-bold">┌ </span><span class="ansi-yellow-fg ansi-bold">Warning: </span>Found `resolution` in the theme when creating a `Scene`. The `resolution` keyword for `Scene`s and `Figure`s has been deprecated. Use `Figure(; size = ...` or `Scene(; size = ...)` instead, which better reflects that this is a unitless size and not a pixel resolution. The key could also come from `set_theme!` calls or related theming functions.

<span class="ansi-yellow-fg ansi-bold">└ </span><span class="ansi-bright-black-fg">@ Makie ~/.julia/packages/Makie/4JW9B/src/scenes.jl:264</span>
</pre>
</div>
</div>
<div class="cell-output cell-output-display" data-execution_count="43">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-43-output-2.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="regional-parameter-estimation" class="level3" data-number="0.15">
<h3 data-number="0.15" class="anchored" data-anchor-id="regional-parameter-estimation"><span class="header-section-number">0.15</span> Regional Parameter Estimation</h3>
<p><em>I will vary both location and scale as when we ran this for a single station that provided less uncertainty. Originally I thought to only vary the location parameter as the scale parameter is less variable over regions but given the uncertainty difference in the single station runs I want to do both.</em></p>
<div id="1bc1f50a" class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Like the lab I am going to pick stations based on lon/lat but I am going to select the first 10 for a bigger pool of data</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>analysis_stations <span class="op">=</span> <span class="kw">let</span></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>    lon <span class="op">=</span> austin_station.longitude</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>    lat <span class="op">=</span> austin_station.latitude</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@chain</span> stations <span class="cf">begin</span></span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@filter</span>(years_of_data <span class="op">&gt;=</span> <span class="fl">40</span>)</span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@mutate</span>(distance <span class="op">=</span> <span class="fu">calc_distance</span>(!!lat, !!lon, latitude, longitude))</span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@arrange</span>(distance)</span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">first</span>(<span class="fl">10</span>)</span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a>analysis_stnids <span class="op">=</span> analysis_stations.stnid</span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a><span class="co">#Need to turn stnid's into a matrix with all data and seperate after </span></span>
<span id="cb71-14"><a href="#cb71-14" aria-hidden="true" tabindex="-1"></a>years_vec, rainfall_matrix <span class="op">=</span> <span class="kw">let</span></span>
<span id="cb71-15"><a href="#cb71-15" aria-hidden="true" tabindex="-1"></a>    rainfall_matrix_data <span class="op">=</span> <span class="pp">@chain</span> rainfall_data <span class="cf">begin</span></span>
<span id="cb71-16"><a href="#cb71-16" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@filter</span>(<span class="fu">in</span>(stnid, !!analysis_stnids))</span>
<span id="cb71-17"><a href="#cb71-17" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@mutate</span>(rainfall_inch <span class="op">=</span> <span class="fu">ifelse</span>(<span class="fu">ismissing</span>(rainfall), <span class="cn">missing</span>, <span class="fu">ustrip</span>(u<span class="st">"inch"</span>, rainfall)))</span>
<span id="cb71-18"><a href="#cb71-18" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@select</span>(year, stnid, rainfall_inch)</span>
<span id="cb71-19"><a href="#cb71-19" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@pivot_wider</span>(names_from <span class="op">=</span> stnid, values_from <span class="op">=</span> rainfall_inch)</span>
<span id="cb71-20"><a href="#cb71-20" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@arrange</span>(year)</span>
<span id="cb71-21"><a href="#cb71-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb71-22"><a href="#cb71-22" aria-hidden="true" tabindex="-1"></a>    years <span class="op">=</span> rainfall_matrix_data.year</span>
<span id="cb71-23"><a href="#cb71-23" aria-hidden="true" tabindex="-1"></a>    matrix <span class="op">=</span> <span class="fu">Matrix</span>(rainfall_matrix_data[<span class="op">:</span>, <span class="fl">2</span><span class="op">:</span><span class="kw">end</span>])</span>
<span id="cb71-24"><a href="#cb71-24" aria-hidden="true" tabindex="-1"></a>    years, matrix</span>
<span id="cb71-25"><a href="#cb71-25" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb71-26"><a href="#cb71-26" aria-hidden="true" tabindex="-1"></a><span class="co">#Now seperating into x and y vectors where y will store rainfall and x will store temp, had to do some funky stuff here since the temp and rainfall sets had mismatching rows/columns</span></span>
<span id="cb71-27"><a href="#cb71-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-28"><a href="#cb71-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract rainfall data for selected stations and pivot wider</span></span>
<span id="cb71-29"><a href="#cb71-29" aria-hidden="true" tabindex="-1"></a>rainfall_wide <span class="op">=</span> <span class="pp">@chain</span> rainfall_data <span class="cf">begin</span></span>
<span id="cb71-30"><a href="#cb71-30" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@filter</span>(<span class="fu">in</span>(stnid, !!analysis_stnids))</span>
<span id="cb71-31"><a href="#cb71-31" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@mutate</span>(rainfall_inch <span class="op">=</span> <span class="fu">ifelse</span>(<span class="fu">ismissing</span>(rainfall), <span class="cn">missing</span>, <span class="fu">ustrip</span>(u<span class="st">"inch"</span>, rainfall)))</span>
<span id="cb71-32"><a href="#cb71-32" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@select</span>(year, stnid, rainfall_inch)</span>
<span id="cb71-33"><a href="#cb71-33" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@pivot_wider</span>(names_from <span class="op">=</span> stnid, values_from <span class="op">=</span> rainfall_inch)</span>
<span id="cb71-34"><a href="#cb71-34" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@arrange</span>(year)</span>
<span id="cb71-35"><a href="#cb71-35" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb71-36"><a href="#cb71-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-37"><a href="#cb71-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract temperature data for all years available</span></span>
<span id="cb71-38"><a href="#cb71-38" aria-hidden="true" tabindex="-1"></a>temp_df <span class="op">=</span> <span class="pp">@chain</span> temp_data <span class="cf">begin</span></span>
<span id="cb71-39"><a href="#cb71-39" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@arrange</span>(year)</span>
<span id="cb71-40"><a href="#cb71-40" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@select</span>(year, temp)</span>
<span id="cb71-41"><a href="#cb71-41" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb71-42"><a href="#cb71-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-43"><a href="#cb71-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Find common years</span></span>
<span id="cb71-44"><a href="#cb71-44" aria-hidden="true" tabindex="-1"></a>common_years <span class="op">=</span> <span class="fu">intersect</span>(rainfall_wide.year, temp_df.year)</span>
<span id="cb71-45"><a href="#cb71-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-46"><a href="#cb71-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter both datasets to these common years</span></span>
<span id="cb71-47"><a href="#cb71-47" aria-hidden="true" tabindex="-1"></a>rainfall_wide <span class="op">=</span> <span class="pp">@chain</span> rainfall_wide <span class="cf">begin</span></span>
<span id="cb71-48"><a href="#cb71-48" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@filter</span>(<span class="fu">in</span>(year, !!common_years))  </span>
<span id="cb71-49"><a href="#cb71-49" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@arrange</span>(year)</span>
<span id="cb71-50"><a href="#cb71-50" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb71-51"><a href="#cb71-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-52"><a href="#cb71-52" aria-hidden="true" tabindex="-1"></a>temp_df <span class="op">=</span> <span class="pp">@chain</span> temp_df <span class="cf">begin</span></span>
<span id="cb71-53"><a href="#cb71-53" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@filter</span>(<span class="fu">in</span>(year, !!common_years))</span>
<span id="cb71-54"><a href="#cb71-54" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@arrange</span>(year)</span>
<span id="cb71-55"><a href="#cb71-55" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb71-56"><a href="#cb71-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-57"><a href="#cb71-57" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert rainfall to matrix and temp to vector</span></span>
<span id="cb71-58"><a href="#cb71-58" aria-hidden="true" tabindex="-1"></a>y_matrix <span class="op">=</span> <span class="fu">Matrix</span>(rainfall_wide[<span class="op">:</span>, <span class="fu">Not</span>(<span class="op">:</span>year)])</span>
<span id="cb71-59"><a href="#cb71-59" aria-hidden="true" tabindex="-1"></a>x_vector <span class="op">=</span> temp_df.temp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="44">
<pre><code>121-element Vector{Float64}:
 66.1
 66.6
 65.8
 64.6
 68.8
 70.5
 68.8
 71.7
 71.6
 68.8
 66.5
 67.6
 67.9
  ⋮
 71.6
 69.0
 70.9
 70.6
 69.0
 72.0
 71.6
 70.0
 69.0
 69.8
 71.4
 72.1</code></pre>
</div>
</div>
<p><em>Now I am going to implement the Regional Model, the model from lab seems to have varying scale and location as well.</em></p>
<div id="5a2ff204" class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">regional_nonstationary_gev</span>(y_matrix, x_vector)</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>    n_years, n_stations <span class="op">=</span> <span class="fu">size</span>(y_matrix)</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Regional parameters (shared across all stations)</span></span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>    β_region <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0.0</span>, <span class="fl">2.0</span>)          <span class="co"># Regional trend (inches per log(ppm))</span></span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>    ξ_region <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0.0</span>, <span class="fl">0.2</span>)          <span class="co"># Regional shape parameter</span></span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Station-specific parameters (independent for each station)</span></span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a>    α_μ_stations <span class="op">~</span> <span class="fu">MvNormal</span>(<span class="fu">fill</span>(<span class="fl">3.0</span>, n_stations), I <span class="op">*</span> <span class="fl">2.0</span>)  <span class="co"># Baseline location for each station</span></span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a>    log_σ_stations <span class="op">~</span> <span class="fu">MvNormal</span>(<span class="fu">zeros</span>(n_stations), I <span class="op">*</span> <span class="fl">0.5</span>)    <span class="co"># Scale parameter for each station</span></span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-13"><a href="#cb73-13" aria-hidden="true" tabindex="-1"></a>    σ_stations <span class="op">=</span> <span class="fu">exp</span>.(log_σ_stations)</span>
<span id="cb73-14"><a href="#cb73-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-15"><a href="#cb73-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Data likelihood - loop over matrix, skip missing values</span></span>
<span id="cb73-16"><a href="#cb73-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span>n_years</span>
<span id="cb73-17"><a href="#cb73-17" aria-hidden="true" tabindex="-1"></a>        x_centered <span class="op">=</span> x_vector[i] <span class="op">-</span> <span class="fl">69.9</span></span>
<span id="cb73-18"><a href="#cb73-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span>n_stations</span>
<span id="cb73-19"><a href="#cb73-19" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> !<span class="fu">ismissing</span>(y_matrix[i, j])</span>
<span id="cb73-20"><a href="#cb73-20" aria-hidden="true" tabindex="-1"></a>                μ_ij <span class="op">=</span> α_μ_stations[j] <span class="op">+</span> β_region <span class="op">*</span> x_centered</span>
<span id="cb73-21"><a href="#cb73-21" aria-hidden="true" tabindex="-1"></a>                dist <span class="op">=</span> <span class="fu">GeneralizedExtremeValue</span>(μ_ij, σ_stations[j], ξ_region)</span>
<span id="cb73-22"><a href="#cb73-22" aria-hidden="true" tabindex="-1"></a>                y_matrix[i, j] <span class="op">~</span> dist</span>
<span id="cb73-23"><a href="#cb73-23" aria-hidden="true" tabindex="-1"></a>            <span class="cf">end</span></span>
<span id="cb73-24"><a href="#cb73-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb73-25"><a href="#cb73-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb73-26"><a href="#cb73-26" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb73-27"><a href="#cb73-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-28"><a href="#cb73-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit regional model with diagnostics</span></span>
<span id="cb73-29"><a href="#cb73-29" aria-hidden="true" tabindex="-1"></a>regional_idata <span class="op">=</span> <span class="kw">let</span></span>
<span id="cb73-30"><a href="#cb73-30" aria-hidden="true" tabindex="-1"></a>    regional_fname <span class="op">=</span> <span class="fu">joinpath</span>(lab_dir, <span class="st">"regional_nonstat.nc"</span>)</span>
<span id="cb73-31"><a href="#cb73-31" aria-hidden="true" tabindex="-1"></a>    regional_model <span class="op">=</span> <span class="fu">regional_nonstationary_gev</span>(y_matrix, x_vector)</span>
<span id="cb73-32"><a href="#cb73-32" aria-hidden="true" tabindex="-1"></a>    overwrite <span class="op">=</span> <span class="cn">true</span></span>
<span id="cb73-33"><a href="#cb73-33" aria-hidden="true" tabindex="-1"></a>    idata2 <span class="op">=</span> <span class="fu">load_or_sample</span>(regional_fname, regional_model; overwrite<span class="op">=</span>overwrite, samples_per_chain<span class="op">=</span><span class="fl">1500</span>)</span>
<span id="cb73-34"><a href="#cb73-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-35"><a href="#cb73-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check diagnostics immediately after fitting</span></span>
<span id="cb73-36"><a href="#cb73-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">println</span>(<span class="st">"=== Regional Model Diagnostics ==="</span>)</span>
<span id="cb73-37"><a href="#cb73-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">display</span>(ArviZ.<span class="fu">summarize</span>(idata2))</span>
<span id="cb73-38"><a href="#cb73-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-39"><a href="#cb73-39" aria-hidden="true" tabindex="-1"></a>    idata2</span>
<span id="cb73-40"><a href="#cb73-40" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<div class="ansi-escaped-output">
<pre><span class="ansi-yellow-fg ansi-bold">┌ </span><span class="ansi-yellow-fg ansi-bold">Warning: </span>Only a single thread available: MCMC chains are not sampled in parallel

<span class="ansi-yellow-fg ansi-bold">└ </span><span class="ansi-bright-black-fg">@ AbstractMCMC ~/.julia/packages/AbstractMCMC/nQLlh/src/sample.jl:410</span>


<span class="ansi-green-fg">Sampling (1 thread):   2%|▌                             |  ETA: 0:00:59</span>

<span class="ansi-green-fg">Sampling (1 thread):   3%|▉                             |  ETA: 0:01:12</span>

<span class="ansi-green-fg">Sampling (1 thread):   4%|█▍                            |  ETA: 0:01:19</span>

<span class="ansi-green-fg">Sampling (1 thread):   6%|█▊                            |  ETA: 0:01:22</span>

<span class="ansi-green-fg">Sampling (1 thread):   8%|██▎                           |  ETA: 0:01:24</span>

<span class="ansi-green-fg">Sampling (1 thread):   9%|██▊                           |  ETA: 0:01:25</span>

<span class="ansi-green-fg">Sampling (1 thread):  10%|███▏                          |  ETA: 0:01:25</span>

<span class="ansi-green-fg">Sampling (1 thread):  12%|███▋                          |  ETA: 0:01:24</span>

<span class="ansi-green-fg">Sampling (1 thread):  14%|████                          |  ETA: 0:01:24</span>

<span class="ansi-green-fg">Sampling (1 thread):  15%|████▌                         |  ETA: 0:01:23</span>

<span class="ansi-green-fg">Sampling (1 thread):  16%|█████                         |  ETA: 0:01:22</span>

<span class="ansi-green-fg">Sampling (1 thread):  18%|█████▍                        |  ETA: 0:01:21</span>

<span class="ansi-green-fg">Sampling (1 thread):  20%|█████▉                        |  ETA: 0:01:19</span>

<span class="ansi-green-fg">Sampling (1 thread):  21%|██████▎                       |  ETA: 0:01:18</span>

<span class="ansi-green-fg">Sampling (1 thread):  22%|██████▊                       |  ETA: 0:01:16</span>

<span class="ansi-green-fg">Sampling (1 thread):  24%|███████▎                      |  ETA: 0:01:15</span>

<span class="ansi-green-fg">Sampling (1 thread):  26%|███████▋                      |  ETA: 0:01:23</span>

<span class="ansi-green-fg">Sampling (1 thread):  27%|████████▏                     |  ETA: 0:01:27</span>

<span class="ansi-green-fg">Sampling (1 thread):  30%|████████▉                     |  ETA: 0:01:24</span>

<span class="ansi-green-fg">Sampling (1 thread):  31%|█████████▎                    |  ETA: 0:01:21</span>

<span class="ansi-green-fg">Sampling (1 thread):  32%|█████████▊                    |  ETA: 0:01:18</span>

<span class="ansi-green-fg">Sampling (1 thread):  34%|██████████▎                   |  ETA: 0:01:16</span>

<span class="ansi-green-fg">Sampling (1 thread):  36%|██████████▋                   |  ETA: 0:01:13</span>

<span class="ansi-green-fg">Sampling (1 thread):  37%|███████████▏                  |  ETA: 0:01:11</span>

<span class="ansi-green-fg">Sampling (1 thread):  38%|███████████▌                  |  ETA: 0:01:08</span>

<span class="ansi-green-fg">Sampling (1 thread):  40%|████████████                  |  ETA: 0:01:06</span>

<span class="ansi-green-fg">Sampling (1 thread):  42%|████████████▌                 |  ETA: 0:01:04</span>

<span class="ansi-green-fg">Sampling (1 thread):  43%|████████████▉                 |  ETA: 0:01:02</span>

<span class="ansi-green-fg">Sampling (1 thread):  44%|█████████████▍                |  ETA: 0:01:00</span>

<span class="ansi-green-fg">Sampling (1 thread):  46%|█████████████▊                |  ETA: 0:00:58</span>

<span class="ansi-green-fg">Sampling (1 thread):  48%|██████████████▎               |  ETA: 0:00:56</span>

<span class="ansi-green-fg">Sampling (1 thread):  49%|██████████████▊               |  ETA: 0:00:54</span>

<span class="ansi-green-fg">Sampling (1 thread):  52%|███████████████▌              |  ETA: 0:00:50</span>

<span class="ansi-green-fg">Sampling (1 thread):  53%|███████████████▉              |  ETA: 0:00:48</span>

<span class="ansi-green-fg">Sampling (1 thread):  54%|████████████████▍             |  ETA: 0:00:46</span>

<span class="ansi-green-fg">Sampling (1 thread):  56%|████████████████▊             |  ETA: 0:00:44</span>

<span class="ansi-green-fg">Sampling (1 thread):  58%|█████████████████▎            |  ETA: 0:00:43</span>

<span class="ansi-green-fg">Sampling (1 thread):  59%|█████████████████▊            |  ETA: 0:00:41</span>

<span class="ansi-green-fg">Sampling (1 thread):  60%|██████████████████▏           |  ETA: 0:00:40</span>

<span class="ansi-green-fg">Sampling (1 thread):  62%|██████████████████▋           |  ETA: 0:00:38</span>

<span class="ansi-green-fg">Sampling (1 thread):  64%|███████████████████           |  ETA: 0:00:37</span>

<span class="ansi-green-fg">Sampling (1 thread):  65%|███████████████████▌          |  ETA: 0:00:35</span>

<span class="ansi-green-fg">Sampling (1 thread):  66%|████████████████████          |  ETA: 0:00:34</span>

<span class="ansi-green-fg">Sampling (1 thread):  68%|████████████████████▍         |  ETA: 0:00:32</span>

<span class="ansi-green-fg">Sampling (1 thread):  70%|████████████████████▉         |  ETA: 0:00:30</span>

<span class="ansi-green-fg">Sampling (1 thread):  71%|█████████████████████▎        |  ETA: 0:00:29</span>

<span class="ansi-green-fg">Sampling (1 thread):  72%|█████████████████████▊        |  ETA: 0:00:27</span>

<span class="ansi-green-fg">Sampling (1 thread):  74%|██████████████████████▎       |  ETA: 0:00:26</span>

<span class="ansi-green-fg">Sampling (1 thread):  76%|██████████████████████▋       |  ETA: 0:00:24</span>

<span class="ansi-green-fg">Sampling (1 thread):  77%|███████████████████████▏      |  ETA: 0:00:23</span>

<span class="ansi-green-fg">Sampling (1 thread):  78%|███████████████████████▌      |  ETA: 0:00:21</span>

<span class="ansi-green-fg">Sampling (1 thread):  80%|████████████████████████      |  ETA: 0:00:20</span>

<span class="ansi-green-fg">Sampling (1 thread):  82%|████████████████████████▌     |  ETA: 0:00:18</span>

<span class="ansi-green-fg">Sampling (1 thread):  83%|████████████████████████▉     |  ETA: 0:00:17</span>

<span class="ansi-green-fg">Sampling (1 thread):  84%|█████████████████████████▍    |  ETA: 0:00:15</span>

<span class="ansi-green-fg">Sampling (1 thread):  86%|█████████████████████████▊    |  ETA: 0:00:14</span>

<span class="ansi-green-fg">Sampling (1 thread):  88%|██████████████████████████▎   |  ETA: 0:00:12</span>

<span class="ansi-green-fg">Sampling (1 thread):  89%|██████████████████████████▊   |  ETA: 0:00:11</span>

<span class="ansi-green-fg">Sampling (1 thread):  90%|███████████████████████████▏  |  ETA: 0:00:09</span>

<span class="ansi-green-fg">Sampling (1 thread):  92%|███████████████████████████▋  |  ETA: 0:00:08</span>

<span class="ansi-green-fg">Sampling (1 thread):  94%|████████████████████████████  |  ETA: 0:00:06</span>

<span class="ansi-green-fg">Sampling (1 thread):  95%|████████████████████████████▌ |  ETA: 0:00:05</span>

<span class="ansi-green-fg">Sampling (1 thread):  96%|█████████████████████████████ |  ETA: 0:00:03</span>

<span class="ansi-green-fg">Sampling (1 thread):  98%|█████████████████████████████▍|  ETA: 0:00:02</span>

<span class="ansi-green-fg">Sampling (1 thread):  99%|█████████████████████████████▉|  ETA: 0:00:00</span>

<span class="ansi-green-fg">Sampling (1 thread): 100%|██████████████████████████████| Time: 0:01:38</span>

<span class="ansi-cyan-fg ansi-bold">[ </span><span class="ansi-cyan-fg ansi-bold">Info: </span>Sampled and cached prior samples to regional_nonstat.nc
</pre>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>=== Regional Model Diagnostics ===</code></pre>
</div>
<div class="cell-output cell-output-display">
<table class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<caption>SummaryStats</caption>
<thead>
<tr class="header headerLastRow">
<th class="rowLabel" data-quarto-table-cell-role="th" style="text-align: left; font-weight: bold;"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th">mean</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">std</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">eti89</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">ess_tail</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">ess_bulk</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">rhat</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">mcse_mean</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">mcse_std</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td class="rowLabel" style="text-align: left; font-weight: bold;">ξ_region</td>
<td style="text-align: right;">0.14</td>
<td style="text-align: right;">0.10</td>
<td style="text-align: left;">-0.0219 .. 0.244</td>
<td style="text-align: right;">95</td>
<td style="text-align: right;">79</td>
<td style="text-align: right;">1.58</td>
<td style="text-align: right;">0.014</td>
<td style="text-align: right;">0.0074</td>
</tr>
<tr class="even">
<td class="rowLabel" style="text-align: left; font-weight: bold;">α_μ_stations[1]</td>
<td style="text-align: right;">2.66</td>
<td style="text-align: right;">0.21</td>
<td style="text-align: left;">2.36 .. 2.96</td>
<td style="text-align: right;">72</td>
<td style="text-align: right;">80</td>
<td style="text-align: right;">1.52</td>
<td style="text-align: right;">0.025</td>
<td style="text-align: right;">0.0095</td>
</tr>
<tr class="odd">
<td class="rowLabel" style="text-align: left; font-weight: bold;">α_μ_stations[2]</td>
<td style="text-align: right;">3.0</td>
<td style="text-align: right;">0.59</td>
<td style="text-align: left;">2.48 .. 4.02</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">77</td>
<td style="text-align: right;">1.59</td>
<td style="text-align: right;">0.083</td>
<td style="text-align: right;">0.046</td>
</tr>
<tr class="even">
<td class="rowLabel" style="text-align: left; font-weight: bold;">α_μ_stations[3]</td>
<td style="text-align: right;">2.98</td>
<td style="text-align: right;">0.30</td>
<td style="text-align: left;">2.66 .. 3.46</td>
<td style="text-align: right;">69</td>
<td style="text-align: right;">78</td>
<td style="text-align: right;">1.53</td>
<td style="text-align: right;">0.041</td>
<td style="text-align: right;">0.021</td>
</tr>
<tr class="odd">
<td class="rowLabel" style="text-align: left; font-weight: bold;">α_μ_stations[4]</td>
<td style="text-align: right;">3.2</td>
<td style="text-align: right;">0.9</td>
<td style="text-align: left;">2.47 .. 4.66</td>
<td style="text-align: right;">88</td>
<td style="text-align: right;">79</td>
<td style="text-align: right;">1.54</td>
<td style="text-align: right;">0.13</td>
<td style="text-align: right;">0.071</td>
</tr>
<tr class="even">
<td class="rowLabel" style="text-align: left; font-weight: bold;">α_μ_stations[5]</td>
<td style="text-align: right;">3.1</td>
<td style="text-align: right;">0.43</td>
<td style="text-align: left;">2.69 .. 3.85</td>
<td style="text-align: right;">81</td>
<td style="text-align: right;">78</td>
<td style="text-align: right;">1.57</td>
<td style="text-align: right;">0.059</td>
<td style="text-align: right;">0.031</td>
</tr>
<tr class="odd">
<td class="rowLabel" style="text-align: left; font-weight: bold;">α_μ_stations[6]</td>
<td style="text-align: right;">3.02</td>
<td style="text-align: right;">0.33</td>
<td style="text-align: left;">2.67 .. 3.56</td>
<td style="text-align: right;">63</td>
<td style="text-align: right;">78</td>
<td style="text-align: right;">1.58</td>
<td style="text-align: right;">0.046</td>
<td style="text-align: right;">0.024</td>
</tr>
<tr class="even">
<td class="rowLabel" style="text-align: left; font-weight: bold;">α_μ_stations[7]</td>
<td style="text-align: right;">2.75</td>
<td style="text-align: right;">0.220</td>
<td style="text-align: left;">2.50 .. 3.12</td>
<td style="text-align: right;">285</td>
<td style="text-align: right;">110</td>
<td style="text-align: right;">1.33</td>
<td style="text-align: right;">0.021</td>
<td style="text-align: right;">0.0018</td>
</tr>
<tr class="odd">
<td class="rowLabel" style="text-align: left; font-weight: bold;">α_μ_stations[8]</td>
<td style="text-align: right;">2.7</td>
<td style="text-align: right;">0.52</td>
<td style="text-align: left;">1.82 .. 3.21</td>
<td style="text-align: right;">72</td>
<td style="text-align: right;">79</td>
<td style="text-align: right;">1.53</td>
<td style="text-align: right;">0.072</td>
<td style="text-align: right;">0.038</td>
</tr>
<tr class="even">
<td class="rowLabel" style="text-align: left; font-weight: bold;">α_μ_stations[9]</td>
<td style="text-align: right;">3.4</td>
<td style="text-align: right;">1.0</td>
<td style="text-align: left;">2.60 .. 5.21</td>
<td style="text-align: right;">64</td>
<td style="text-align: right;">78</td>
<td style="text-align: right;">1.57</td>
<td style="text-align: right;">0.15</td>
<td style="text-align: right;">0.084</td>
</tr>
<tr class="odd">
<td class="rowLabel" style="text-align: left; font-weight: bold;">α_μ_stations[10]</td>
<td style="text-align: right;">2.9</td>
<td style="text-align: right;">0.53</td>
<td style="text-align: left;">2.44 .. 3.82</td>
<td style="text-align: right;">67</td>
<td style="text-align: right;">78</td>
<td style="text-align: right;">1.59</td>
<td style="text-align: right;">0.075</td>
<td style="text-align: right;">0.041</td>
</tr>
<tr class="even">
<td class="rowLabel" style="text-align: left; font-weight: bold;">log_σ_stations[1]</td>
<td style="text-align: right;">0.30</td>
<td style="text-align: right;">0.28</td>
<td style="text-align: left;">0.00554 .. 0.770</td>
<td style="text-align: right;">66</td>
<td style="text-align: right;">78</td>
<td style="text-align: right;">1.55</td>
<td style="text-align: right;">0.039</td>
<td style="text-align: right;">0.021</td>
</tr>
<tr class="odd">
<td class="rowLabel" style="text-align: left; font-weight: bold;">log_σ_stations[2]</td>
<td style="text-align: right;">-0.011</td>
<td style="text-align: right;">0.110</td>
<td style="text-align: left;">-0.202 .. 0.154</td>
<td style="text-align: right;">5324</td>
<td style="text-align: right;">876</td>
<td style="text-align: right;">1.30</td>
<td style="text-align: right;">0.0037</td>
<td style="text-align: right;">0.0039</td>
</tr>
<tr class="even">
<td class="rowLabel" style="text-align: left; font-weight: bold;">log_σ_stations[3]</td>
<td style="text-align: right;">-0.06</td>
<td style="text-align: right;">0.20</td>
<td style="text-align: left;">-0.306 .. 0.256</td>
<td style="text-align: right;">54</td>
<td style="text-align: right;">77</td>
<td style="text-align: right;">1.59</td>
<td style="text-align: right;">0.026</td>
<td style="text-align: right;">0.012</td>
</tr>
<tr class="odd">
<td class="rowLabel" style="text-align: left; font-weight: bold;">log_σ_stations[4]</td>
<td style="text-align: right;">-0.005</td>
<td style="text-align: right;">0.102</td>
<td style="text-align: left;">-0.185 .. 0.147</td>
<td style="text-align: right;">3682</td>
<td style="text-align: right;">697</td>
<td style="text-align: right;">1.20</td>
<td style="text-align: right;">0.0039</td>
<td style="text-align: right;">0.0034</td>
</tr>
<tr class="even">
<td class="rowLabel" style="text-align: left; font-weight: bold;">log_σ_stations[5]</td>
<td style="text-align: right;">0.16</td>
<td style="text-align: right;">0.139</td>
<td style="text-align: left;">-0.0494 .. 0.346</td>
<td style="text-align: right;">93</td>
<td style="text-align: right;">88</td>
<td style="text-align: right;">1.47</td>
<td style="text-align: right;">0.016</td>
<td style="text-align: right;">0.0043</td>
</tr>
<tr class="odd">
<td class="rowLabel" style="text-align: left; font-weight: bold;">log_σ_stations[6]</td>
<td style="text-align: right;">0.003</td>
<td style="text-align: right;">0.117</td>
<td style="text-align: left;">-0.159 .. 0.176</td>
<td style="text-align: right;">95</td>
<td style="text-align: right;">82</td>
<td style="text-align: right;">1.51</td>
<td style="text-align: right;">0.014</td>
<td style="text-align: right;">0.0046</td>
</tr>
<tr class="even">
<td class="rowLabel" style="text-align: left; font-weight: bold;">log_σ_stations[7]</td>
<td style="text-align: right;">0.36</td>
<td style="text-align: right;">0.24</td>
<td style="text-align: left;">0.0405 .. 0.712</td>
<td style="text-align: right;">96</td>
<td style="text-align: right;">80</td>
<td style="text-align: right;">1.53</td>
<td style="text-align: right;">0.030</td>
<td style="text-align: right;">0.013</td>
</tr>
<tr class="odd">
<td class="rowLabel" style="text-align: left; font-weight: bold;">log_σ_stations[8]</td>
<td style="text-align: right;">0.005</td>
<td style="text-align: right;">0.116</td>
<td style="text-align: left;">-0.150 .. 0.214</td>
<td style="text-align: right;">4207</td>
<td style="text-align: right;">413</td>
<td style="text-align: right;">1.07</td>
<td style="text-align: right;">0.0061</td>
<td style="text-align: right;">0.0030</td>
</tr>
<tr class="even">
<td class="rowLabel" style="text-align: left; font-weight: bold;">log_σ_stations[9]</td>
<td style="text-align: right;">-0.06</td>
<td style="text-align: right;">0.58</td>
<td style="text-align: left;">-1.06 .. 0.429</td>
<td style="text-align: right;">52</td>
<td style="text-align: right;">77</td>
<td style="text-align: right;">1.59</td>
<td style="text-align: right;">0.084</td>
<td style="text-align: right;">0.047</td>
</tr>
<tr class="odd">
<td class="rowLabel" style="text-align: left; font-weight: bold;">log_σ_stations[10]</td>
<td style="text-align: right;">0.3</td>
<td style="text-align: right;">0.52</td>
<td style="text-align: left;">-0.105 .. 1.22</td>
<td style="text-align: right;">63</td>
<td style="text-align: right;">78</td>
<td style="text-align: right;">1.53</td>
<td style="text-align: right;">0.074</td>
<td style="text-align: right;">0.042</td>
</tr>
<tr class="even">
<td class="rowLabel" style="text-align: left; font-weight: bold;">β_region</td>
<td style="text-align: right;">0.8</td>
<td style="text-align: right;">1.6</td>
<td style="text-align: left;">-0.109 .. 3.60</td>
<td style="text-align: right;">95</td>
<td style="text-align: right;">79</td>
<td style="text-align: right;">1.59</td>
<td style="text-align: right;">0.23</td>
<td style="text-align: right;">0.13</td>
</tr>
</tbody>
</table>
</div>
<div class="cell-output cell-output-display" data-execution_count="45">
<div>InferenceData<details>
<summary>posterior</summary>
<pre><span class="sgr90">┌ </span><span class="sgr38_5" style="color:#ff875f">6000</span>×<span class="sgr38_5" style="color:#0087d7">4</span>×<span class="sgr38_5" style="color:#5fd7ff">10</span>×<span class="sgr38_5" style="color:#ff5f87">10</span> Dataset<span class="sgr90"> ┐</span>
<span class="sgr90">├──────────────────────┴───────────────────────────────────────────────── dims ┐</span>
  <span class="sgr38_5" style="color:#ff875f">↓ draw</span>, <span class="sgr38_5" style="color:#0087d7">→ chain</span>, <span class="sgr38_5" style="color:#5fd7ff">↗ α_μ_stations_dim_1</span>, <span class="sgr38_5" style="color:#ff5f87">⬔ log_σ_stations_dim_1</span>
<span class="sgr90">├────────────────────────────────────────────────────────────────────── layers ┤</span>
<span class="sgr38_5" style="color:#00afaf">  :ξ_region      </span><span class="sgr90"> eltype: </span>Float64<span class="sgr90"> dims: </span><span class="sgr38_5" style="color:#ff875f">draw</span>, <span class="sgr38_5" style="color:#0087d7">chain</span><span class="sgr90"> size: </span><span class="sgr38_5" style="color:#ff875f">6000</span>×<span class="sgr38_5" style="color:#0087d7">4</span>
<span class="sgr38_5" style="color:#00afaf">  :α_μ_stations  </span><span class="sgr90"> eltype: </span>Float64<span class="sgr90"> dims: </span><span class="sgr38_5" style="color:#ff875f">draw</span>, <span class="sgr38_5" style="color:#0087d7">chain</span>, <span class="sgr38_5" style="color:#5fd7ff">α_μ_stations_dim_1</span><span class="sgr90"> size: </span><span class="sgr38_5" style="color:#ff875f">6000</span>×<span class="sgr38_5" style="color:#0087d7">4</span>×<span class="sgr38_5" style="color:#5fd7ff">10</span>
<span class="sgr38_5" style="color:#00afaf">  :log_σ_stations</span><span class="sgr90"> eltype: </span>Float64<span class="sgr90"> dims: </span><span class="sgr38_5" style="color:#ff875f">draw</span>, <span class="sgr38_5" style="color:#0087d7">chain</span>, <span class="sgr38_5" style="color:#ff5f87">log_σ_stations_dim_1</span><span class="sgr90"> size: </span><span class="sgr38_5" style="color:#ff875f">6000</span>×<span class="sgr38_5" style="color:#0087d7">4</span>×<span class="sgr38_5" style="color:#ff5f87">10</span>
<span class="sgr38_5" style="color:#00afaf">  :β_region      </span><span class="sgr90"> eltype: </span>Float64<span class="sgr90"> dims: </span><span class="sgr38_5" style="color:#ff875f">draw</span>, <span class="sgr38_5" style="color:#0087d7">chain</span><span class="sgr90"> size: </span><span class="sgr38_5" style="color:#ff875f">6000</span>×<span class="sgr38_5" style="color:#0087d7">4</span>
<span class="sgr90">├──────────────────────────────────────────────────────────────────── metadata ┤</span>
  Dict{String, Any} with 3 entries:
  "created_at" =&gt; "2025-10-02T09:47:44.326"
  "inference_library_version" =&gt; "7.4.0"
  "inference_library" =&gt; "MCMCChains"
</pre></details>
<details>
<summary>sample_stats</summary>
<pre><span class="sgr90">┌ </span><span class="sgr38_5" style="color:#ff875f">6000</span>×<span class="sgr38_5" style="color:#0087d7">4</span> Dataset<span class="sgr90"> ┐</span>
<span class="sgr90">├────────────────┴──────────────────────────────────────────── dims ┐</span>
  <span class="sgr38_5" style="color:#ff875f">↓ draw</span>, <span class="sgr38_5" style="color:#0087d7">→ chain</span>
<span class="sgr90">├─────────────────────────────────────────────────────────── layers ┤</span>
<span class="sgr38_5" style="color:#00afaf">  :energy          </span><span class="sgr90"> eltype: </span>Float64<span class="sgr90"> dims: </span><span class="sgr38_5" style="color:#ff875f">draw</span>, <span class="sgr38_5" style="color:#0087d7">chain</span><span class="sgr90"> size: </span><span class="sgr38_5" style="color:#ff875f">6000</span>×<span class="sgr38_5" style="color:#0087d7">4</span>
<span class="sgr38_5" style="color:#00afaf">  :n_steps         </span><span class="sgr90"> eltype: </span>Int64<span class="sgr90"> dims: </span><span class="sgr38_5" style="color:#ff875f">draw</span>, <span class="sgr38_5" style="color:#0087d7">chain</span><span class="sgr90"> size: </span><span class="sgr38_5" style="color:#ff875f">6000</span>×<span class="sgr38_5" style="color:#0087d7">4</span>
<span class="sgr38_5" style="color:#00afaf">  :diverging       </span><span class="sgr90"> eltype: </span>Bool<span class="sgr90"> dims: </span><span class="sgr38_5" style="color:#ff875f">draw</span>, <span class="sgr38_5" style="color:#0087d7">chain</span><span class="sgr90"> size: </span><span class="sgr38_5" style="color:#ff875f">6000</span>×<span class="sgr38_5" style="color:#0087d7">4</span>
<span class="sgr38_5" style="color:#00afaf">  :max_energy_error</span><span class="sgr90"> eltype: </span>Float64<span class="sgr90"> dims: </span><span class="sgr38_5" style="color:#ff875f">draw</span>, <span class="sgr38_5" style="color:#0087d7">chain</span><span class="sgr90"> size: </span><span class="sgr38_5" style="color:#ff875f">6000</span>×<span class="sgr38_5" style="color:#0087d7">4</span>
<span class="sgr38_5" style="color:#00afaf">  :loglikelihood   </span><span class="sgr90"> eltype: </span>Float64<span class="sgr90"> dims: </span><span class="sgr38_5" style="color:#ff875f">draw</span>, <span class="sgr38_5" style="color:#0087d7">chain</span><span class="sgr90"> size: </span><span class="sgr38_5" style="color:#ff875f">6000</span>×<span class="sgr38_5" style="color:#0087d7">4</span>
<span class="sgr38_5" style="color:#00afaf">  :energy_error    </span><span class="sgr90"> eltype: </span>Float64<span class="sgr90"> dims: </span><span class="sgr38_5" style="color:#ff875f">draw</span>, <span class="sgr38_5" style="color:#0087d7">chain</span><span class="sgr90"> size: </span><span class="sgr38_5" style="color:#ff875f">6000</span>×<span class="sgr38_5" style="color:#0087d7">4</span>
<span class="sgr38_5" style="color:#00afaf">  :is_accept       </span><span class="sgr90"> eltype: </span>Bool<span class="sgr90"> dims: </span><span class="sgr38_5" style="color:#ff875f">draw</span>, <span class="sgr38_5" style="color:#0087d7">chain</span><span class="sgr90"> size: </span><span class="sgr38_5" style="color:#ff875f">6000</span>×<span class="sgr38_5" style="color:#0087d7">4</span>
<span class="sgr38_5" style="color:#00afaf">  :logprior        </span><span class="sgr90"> eltype: </span>Float64<span class="sgr90"> dims: </span><span class="sgr38_5" style="color:#ff875f">draw</span>, <span class="sgr38_5" style="color:#0087d7">chain</span><span class="sgr90"> size: </span><span class="sgr38_5" style="color:#ff875f">6000</span>×<span class="sgr38_5" style="color:#0087d7">4</span>
<span class="sgr38_5" style="color:#00afaf">  :log_density     </span><span class="sgr90"> eltype: </span>Float64<span class="sgr90"> dims: </span><span class="sgr38_5" style="color:#ff875f">draw</span>, <span class="sgr38_5" style="color:#0087d7">chain</span><span class="sgr90"> size: </span><span class="sgr38_5" style="color:#ff875f">6000</span>×<span class="sgr38_5" style="color:#0087d7">4</span>
<span class="sgr38_5" style="color:#00afaf">  :tree_depth      </span><span class="sgr90"> eltype: </span>Int64<span class="sgr90"> dims: </span><span class="sgr38_5" style="color:#ff875f">draw</span>, <span class="sgr38_5" style="color:#0087d7">chain</span><span class="sgr90"> size: </span><span class="sgr38_5" style="color:#ff875f">6000</span>×<span class="sgr38_5" style="color:#0087d7">4</span>
<span class="sgr38_5" style="color:#00afaf">  :step_size       </span><span class="sgr90"> eltype: </span>Float64<span class="sgr90"> dims: </span><span class="sgr38_5" style="color:#ff875f">draw</span>, <span class="sgr38_5" style="color:#0087d7">chain</span><span class="sgr90"> size: </span><span class="sgr38_5" style="color:#ff875f">6000</span>×<span class="sgr38_5" style="color:#0087d7">4</span>
<span class="sgr38_5" style="color:#00afaf">  :acceptance_rate </span><span class="sgr90"> eltype: </span>Float64<span class="sgr90"> dims: </span><span class="sgr38_5" style="color:#ff875f">draw</span>, <span class="sgr38_5" style="color:#0087d7">chain</span><span class="sgr90"> size: </span><span class="sgr38_5" style="color:#ff875f">6000</span>×<span class="sgr38_5" style="color:#0087d7">4</span>
<span class="sgr38_5" style="color:#00afaf">  :lp              </span><span class="sgr90"> eltype: </span>Float64<span class="sgr90"> dims: </span><span class="sgr38_5" style="color:#ff875f">draw</span>, <span class="sgr38_5" style="color:#0087d7">chain</span><span class="sgr90"> size: </span><span class="sgr38_5" style="color:#ff875f">6000</span>×<span class="sgr38_5" style="color:#0087d7">4</span>
<span class="sgr38_5" style="color:#00afaf">  :step_size_nom   </span><span class="sgr90"> eltype: </span>Float64<span class="sgr90"> dims: </span><span class="sgr38_5" style="color:#ff875f">draw</span>, <span class="sgr38_5" style="color:#0087d7">chain</span><span class="sgr90"> size: </span><span class="sgr38_5" style="color:#ff875f">6000</span>×<span class="sgr38_5" style="color:#0087d7">4</span>
<span class="sgr90">├───────────────────────────────────────────────────────── metadata ┤</span>
  Dict{String, Any} with 3 entries:
  "created_at" =&gt; "2025-10-02T09:47:44.301"
  "inference_library_version" =&gt; "7.4.0"
  "inference_library" =&gt; "MCMCChains"
</pre></details>
</div>
</div>
</div>
</section>
<section id="posterior-uncertainty-50-year-return-levels" class="level3" data-number="0.16">
<h3 data-number="0.16" class="anchored" data-anchor-id="posterior-uncertainty-50-year-return-levels"><span class="header-section-number">0.16</span> Posterior Uncertainty 50-Year Return Levels</h3>
<p><em>First we need to extract the GEVs for both single and multi station runs</em></p>
<div id="ed850ec5" class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>my_station_idx <span class="op">=</span> <span class="fu">findfirst</span>(x <span class="op">-&gt;</span> x <span class="op">==</span> my_stnid, analysis_stnids)</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>regional_my_station <span class="op">=</span> <span class="kw">let</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract regional parameters (shared)</span></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>    β_samples <span class="op">=</span> <span class="fu">vec</span>(<span class="fu">Array</span>(regional_idata.posterior[<span class="op">:</span>β_region]))</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>    ξ_samples <span class="op">=</span> <span class="fu">vec</span>(<span class="fu">Array</span>(regional_idata.posterior[<span class="op">:</span>ξ_region]))</span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract station-specific parameters for our station</span></span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>    α_μ_samples <span class="op">=</span> <span class="fu">vec</span>(<span class="fu">Array</span>(regional_idata.posterior[<span class="op">:</span>α_μ_stations])[<span class="op">:</span>, <span class="op">:</span>, my_station_idx])</span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>    σ_samples <span class="op">=</span> <span class="fu">exp</span>.(<span class="fu">vec</span>(<span class="fu">Array</span>(regional_idata.posterior[<span class="op">:</span>log_σ_stations])[<span class="op">:</span>, <span class="op">:</span>, my_station_idx]))</span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a>    (α_μ<span class="op">=</span>α_μ_samples, β_μ<span class="op">=</span>β_samples, σ<span class="op">=</span>σ_samples, ξ<span class="op">=</span>ξ_samples)</span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-14"><a href="#cb75-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract single-station model results (Model 1: Location trend only)</span></span>
<span id="cb75-15"><a href="#cb75-15" aria-hidden="true" tabindex="-1"></a>single_station <span class="op">=</span> <span class="kw">let</span></span>
<span id="cb75-16"><a href="#cb75-16" aria-hidden="true" tabindex="-1"></a>    model1_idata <span class="op">=</span> posterior_results[<span class="fl">1</span>].idata</span>
<span id="cb75-17"><a href="#cb75-17" aria-hidden="true" tabindex="-1"></a>    α_μ_samples <span class="op">=</span> <span class="fu">vec</span>(<span class="fu">Array</span>(model1_idata.posterior[<span class="op">:</span>α_μ]))</span>
<span id="cb75-18"><a href="#cb75-18" aria-hidden="true" tabindex="-1"></a>    β_μ_samples <span class="op">=</span> <span class="fu">vec</span>(<span class="fu">Array</span>(model1_idata.posterior[<span class="op">:</span>β_μ]))</span>
<span id="cb75-19"><a href="#cb75-19" aria-hidden="true" tabindex="-1"></a>    σ_samples <span class="op">=</span> <span class="fu">exp</span>.(<span class="fu">vec</span>(<span class="fu">Array</span>(model1_idata.posterior[<span class="op">:</span>log_σ])))</span>
<span id="cb75-20"><a href="#cb75-20" aria-hidden="true" tabindex="-1"></a>    ξ_samples <span class="op">=</span> <span class="fu">vec</span>(<span class="fu">Array</span>(model1_idata.posterior[<span class="op">:</span>ξ]))</span>
<span id="cb75-21"><a href="#cb75-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-22"><a href="#cb75-22" aria-hidden="true" tabindex="-1"></a>    (α_μ<span class="op">=</span>α_μ_samples, β_μ<span class="op">=</span>β_μ_samples, σ<span class="op">=</span>σ_samples, ξ<span class="op">=</span>ξ_samples)</span>
<span id="cb75-23"><a href="#cb75-23" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb75-24"><a href="#cb75-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-25"><a href="#cb75-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare data for comparison plots</span></span>
<span id="cb75-26"><a href="#cb75-26" aria-hidden="true" tabindex="-1"></a>rts <span class="op">=</span> <span class="fu">logrange</span>(<span class="fl">1.1</span>, <span class="fl">250</span>, <span class="fl">100</span>)</span>
<span id="cb75-27"><a href="#cb75-27" aria-hidden="true" tabindex="-1"></a>xticks <span class="op">=</span> [<span class="fl">2</span>, <span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">25</span>, <span class="fl">50</span>, <span class="fl">100</span>, <span class="fl">250</span>]</span>
<span id="cb75-28"><a href="#cb75-28" aria-hidden="true" tabindex="-1"></a>x_2025 <span class="op">=</span> temp_data.temp[temp_data.year<span class="op">.==</span><span class="fl">2024</span>][<span class="fl">1</span>]</span>
<span id="cb75-29"><a href="#cb75-29" aria-hidden="true" tabindex="-1"></a>x_centered <span class="op">=</span> x_2025 <span class="op">-</span> <span class="fu">log</span>(<span class="fl">380</span>)</span>
<span id="cb75-30"><a href="#cb75-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-31"><a href="#cb75-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Create GEV distributions for 2025</span></span>
<span id="cb75-32"><a href="#cb75-32" aria-hidden="true" tabindex="-1"></a>μ_single_2025 <span class="op">=</span> single_station.α_μ <span class="op">.+</span> single_station.β_μ <span class="op">.*</span> x_centered</span>
<span id="cb75-33"><a href="#cb75-33" aria-hidden="true" tabindex="-1"></a>gevs_single <span class="op">=</span> <span class="fu">GeneralizedExtremeValue</span>.(μ_single_2025, single_station.σ, single_station.ξ)</span>
<span id="cb75-34"><a href="#cb75-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-35"><a href="#cb75-35" aria-hidden="true" tabindex="-1"></a>μ_regional_2025 <span class="op">=</span> regional_my_station.α_μ <span class="op">.+</span> regional_my_station.β_μ <span class="op">.*</span> x_centered</span>
<span id="cb75-36"><a href="#cb75-36" aria-hidden="true" tabindex="-1"></a>gevs_regional <span class="op">=</span> <span class="fu">GeneralizedExtremeValue</span>.(μ_regional_2025, regional_my_station.σ, regional_my_station.ξ)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="46">
<pre><code>24000-element Vector{GeneralizedExtremeValue{Float64}}:
 GeneralizedExtremeValue{Float64}(μ=-3.876765906335033, σ=1.0800148601723336, ξ=0.17753673351951682)
 GeneralizedExtremeValue{Float64}(μ=-1.881655239772281, σ=1.1690286301082273, ξ=0.22961883896925422)
 GeneralizedExtremeValue{Float64}(μ=-3.925312306833927, σ=1.0673362678413774, ξ=0.20675368496130392)
 GeneralizedExtremeValue{Float64}(μ=-6.236280563073564, σ=1.2885702880548884, ξ=0.16431474205128258)
 GeneralizedExtremeValue{Float64}(μ=-1.518533329617549, σ=1.126670476265995, ξ=0.2574434638949811)
 GeneralizedExtremeValue{Float64}(μ=-2.053240414637127, σ=1.2050711704774097, ξ=0.2633730497660074)
 GeneralizedExtremeValue{Float64}(μ=-1.5439857838152489, σ=1.204115655431863, ξ=0.15412244585770857)
 GeneralizedExtremeValue{Float64}(μ=-4.447274944774938, σ=1.0976662397132482, ξ=0.22339405352981323)
 GeneralizedExtremeValue{Float64}(μ=-3.2187815291389263, σ=1.2848112855148544, ξ=0.2291410337867214)
 GeneralizedExtremeValue{Float64}(μ=-2.934382257330656, σ=1.031618698387063, ξ=0.17307240671326965)
 GeneralizedExtremeValue{Float64}(μ=-3.9575564152014464, σ=1.3963076219639643, ξ=0.18934806348525932)
 GeneralizedExtremeValue{Float64}(μ=-1.163557108233868, σ=0.966741558230652, ξ=0.1717003501634849)
 GeneralizedExtremeValue{Float64}(μ=-3.3749326753791475, σ=1.2383698609182163, ξ=0.16359613324640254)
 ⋮
 GeneralizedExtremeValue{Float64}(μ=-1.8274662100332333, σ=1.2361584709540283, ξ=0.18854536421928375)
 GeneralizedExtremeValue{Float64}(μ=-0.3220320957592988, σ=0.9696780663853458, ξ=0.1946566304246908)
 GeneralizedExtremeValue{Float64}(μ=-2.928838517129481, σ=1.223647952262686, ξ=0.18004893031799604)
 GeneralizedExtremeValue{Float64}(μ=-1.7406912325854944, σ=1.2033597327407157, ξ=0.209554970334695)
 GeneralizedExtremeValue{Float64}(μ=-1.2783456761844305, σ=1.2005562770526748, ξ=0.1704301874446023)
 GeneralizedExtremeValue{Float64}(μ=-0.8397404308505103, σ=1.1193787250248448, ξ=0.15974921605370565)
 GeneralizedExtremeValue{Float64}(μ=-0.33939042835248134, σ=1.0989047324381278, ξ=0.17128355815425655)
 GeneralizedExtremeValue{Float64}(μ=-3.8287204864516244, σ=1.214052338098277, ξ=0.19441993185580644)
 GeneralizedExtremeValue{Float64}(μ=-4.226819898841794, σ=1.201851530891346, ξ=0.2153464212002743)
 GeneralizedExtremeValue{Float64}(μ=-1.0469362493632897, σ=1.0599658640033356, ξ=0.19408658329701095)
 GeneralizedExtremeValue{Float64}(μ=-0.10855155384324178, σ=1.2062559083727389, ξ=0.17387446093144904)
 GeneralizedExtremeValue{Float64}(μ=-4.724729108458114, σ=1.1369907635019394, ξ=0.2097729140918138)</code></pre>
</div>
</div>
<p><em>Now we can plot the GEVs for comparison of their 50 year Return Levels:</em></p>
<div id="847dfb02" class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>return_level_dist_fig <span class="op">=</span> <span class="kw">let</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> <span class="fu">Figure</span>(size<span class="op">=</span>(<span class="fl">800</span>, <span class="fl">400</span>))</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>    ax <span class="op">=</span> <span class="fu">Axis</span>(fig[<span class="fl">1</span>, <span class="fl">1</span>], xlabel<span class="op">=</span><span class="st">"50-year Return Level (inches)"</span>, ylabel<span class="op">=</span><span class="st">"Density"</span>,</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>        title<span class="op">=</span><span class="st">"50-year Return Level Uncertainty"</span>)</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate 100-year return levels</span></span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>    rl50_single <span class="op">=</span> [<span class="fu">quantile</span>(gev, <span class="fl">0.99</span>) for gev <span class="kw">in</span> gevs_single]</span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>    rl50_regional <span class="op">=</span> [<span class="fu">quantile</span>(gev, <span class="fl">0.99</span>) for gev <span class="kw">in</span> gevs_regional]</span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">hist!</span>(ax, rl50_single, bins<span class="op">=</span><span class="fl">30</span>, color<span class="op">=</span>(<span class="op">:</span>blue, <span class="fl">0.5</span>), label<span class="op">=</span><span class="st">"Single-Station"</span>, normalization<span class="op">=:</span>pdf)</span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">hist!</span>(ax, rl50_regional, bins<span class="op">=</span><span class="fl">30</span>, color<span class="op">=</span>(<span class="op">:</span>red, <span class="fl">0.5</span>), label<span class="op">=</span><span class="st">"Regional"</span>, normalization<span class="op">=:</span>pdf)</span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">axislegend</span>(ax, position<span class="op">=:</span>rt)</span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-16"><a href="#cb77-16" aria-hidden="true" tabindex="-1"></a>    fig</span>
<span id="cb77-17"><a href="#cb77-17" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<div class="ansi-escaped-output">
<pre><span class="ansi-yellow-fg ansi-bold">┌ </span><span class="ansi-yellow-fg ansi-bold">Warning: </span>Found `resolution` in the theme when creating a `Scene`. The `resolution` keyword for `Scene`s and `Figure`s has been deprecated. Use `Figure(; size = ...` or `Scene(; size = ...)` instead, which better reflects that this is a unitless size and not a pixel resolution. The key could also come from `set_theme!` calls or related theming functions.

<span class="ansi-yellow-fg ansi-bold">└ </span><span class="ansi-bright-black-fg">@ Makie ~/.julia/packages/Makie/4JW9B/src/scenes.jl:264</span>
</pre>
</div>
</div>
<div class="cell-output cell-output-display" data-execution_count="47">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-47-output-2.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p><em>Regional seems to have some sort of issue (maybe stemming from all the data manipulation I had to do to make temp and rainfall have same length???) that leads to a high density outlier</em></p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        const annoteTargets = window.document.querySelectorAll('.code-annotation-anchor');
        for (let i=0; i<annoteTargets.length; i++) {
          const annoteTarget = annoteTargets[i];
          const targetCell = annoteTarget.getAttribute("data-target-cell");
          const targetAnnotation = annoteTarget.getAttribute("data-target-annotation");
          const contentFn = () => {
            const content = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
            if (content) {
              const tipContent = content.cloneNode(true);
              tipContent.classList.add("code-annotation-tip-content");
              return tipContent.outerHTML;
            }
          }
          const config = {
            allowHTML: true,
            content: contentFn,
            onShow: (instance) => {
              selectCodeLines(instance.reference);
              instance.reference.classList.add('code-annotation-active');
              window.tippy.hideAll();
            },
            onHide: (instance) => {
              unselectCodeLines();
              instance.reference.classList.remove('code-annotation-active');
            },
            maxWidth: 300,
            delay: [50, 0],
            duration: [200, 0],
            offset: [5, 10],
            arrow: true,
            appendTo: function(el) {
              return el.parentElement.parentElement.parentElement;
            },
            interactive: true,
            interactiveBorder: 10,
            theme: 'quarto',
            placement: 'right',
            popperOptions: {
              modifiers: [
              {
                name: 'flip',
                options: {
                  flipVariations: false, // true by default
                  allowedAutoPlacements: ['right'],
                  fallbackPlacements: ['right', 'top', 'top-start', 'top-end', 'bottom', 'bottom-start', 'bottom-end', 'left'],
                },
              },
              {
                name: 'preventOverflow',
                options: {
                  mainAxis: false,
                  altAxis: false
                }
              }
              ]        
            }      
          };
          window.tippy(annoteTarget, config); 
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>